import {
  AbstractSoundSource
} from "./chunk-Q5VTOXVS.js";
import {
  _HasSpatialAudioOptions,
  _SpatialWebAudio,
  _StereoAudio,
  _WebAudioBusAndSoundSubGraph
} from "./chunk-2UA55PIM.js";

// node_modules/@babylonjs/core/AudioV2/webAudio/webAudioSoundSource.js
var _WebAudioSoundSource = class __WebAudioSoundSource extends AbstractSoundSource {
  /** @internal */
  constructor(name, webAudioNode, engine, options) {
    super(name, engine, options);
    this._stereo = null;
    this._audioContext = this.engine._audioContext;
    this._webAudioNode = webAudioNode;
    this._subGraph = new __WebAudioSoundSource._SubGraph(this);
  }
  /** @internal */
  async _initAsync(options) {
    if (options.outBus) {
      this.outBus = options.outBus;
    } else if (options.outBusAutoDefault !== false) {
      await this.engine.isReadyPromise;
      this.outBus = this.engine.defaultMainBus;
    }
    await this._subGraph.initAsync(options);
    if (_HasSpatialAudioOptions(options)) {
      this._initSpatialProperty();
    }
    this.engine._addNode(this);
  }
  /** @internal */
  get _inNode() {
    return this._webAudioNode;
  }
  /** @internal */
  get _outNode() {
    return this._subGraph._outNode;
  }
  /** @internal */
  get stereo() {
    return this._stereo ?? (this._stereo = new _StereoAudio(this._subGraph));
  }
  /** @internal */
  dispose() {
    super.dispose();
    this._stereo = null;
    this._subGraph.dispose();
    this.engine._removeNode(this);
  }
  /** @internal */
  getClassName() {
    return "_WebAudioSoundSource";
  }
  _connect(node) {
    const connected = super._connect(node);
    if (!connected) {
      return false;
    }
    if (node._inNode) {
      this._outNode?.connect(node._inNode);
    }
    return true;
  }
  _disconnect(node) {
    const disconnected = super._disconnect(node);
    if (!disconnected) {
      return false;
    }
    if (node._inNode) {
      this._outNode?.disconnect(node._inNode);
    }
    return true;
  }
  _createSpatialProperty(autoUpdate, minUpdateTime) {
    return new _SpatialWebAudio(this._subGraph, autoUpdate, minUpdateTime);
  }
};
_WebAudioSoundSource._SubGraph = class extends _WebAudioBusAndSoundSubGraph {
  get _downstreamNodes() {
    return this._owner._downstreamNodes ?? null;
  }
  get _upstreamNodes() {
    return this._owner._upstreamNodes ?? null;
  }
  _onSubNodesChanged() {
    super._onSubNodesChanged();
    this._owner._inNode.disconnect();
    if (this._owner._subGraph._inNode) {
      this._owner._inNode.connect(this._owner._subGraph._inNode);
    }
  }
};

export {
  _WebAudioSoundSource
};
//# sourceMappingURL=chunk-M3C4MKT6.js.map
