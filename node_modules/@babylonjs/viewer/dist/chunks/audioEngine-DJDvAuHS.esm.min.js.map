{"version":3,"file":"audioEngine-DJDvAuHS.esm.min.js","sources":["../../../../../dev/core/dist/AudioV2/abstractAudio/abstractAudioNode.js","../../../../../dev/core/dist/AudioV2/abstractAudio/components/spatialAudioAttacherComponent.js","../../../../../dev/core/dist/AudioV2/audioUtils.js","../../../../../dev/core/dist/AudioV2/webAudio/components/webAudioParameterComponent.js","../../../../../dev/core/dist/AudioV2/webAudio/components/spatialWebAudioUpdaterComponent.js","../../../../../dev/core/dist/AudioV2/abstractAudio/audioEngineV2.js","../../../../../dev/core/dist/AudioV2/abstractAudio/subProperties/abstractSpatialAudioListener.js","../../../../../dev/core/dist/AudioV2/abstractAudio/subProperties/spatialAudioListener.js","../../../../../dev/core/dist/AudioV2/webAudio/subProperties/spatialWebAudioListener.js","../../../../../dev/core/dist/AudioV2/abstractAudio/mainAudioOut.js","../../../../../dev/core/dist/AudioV2/webAudio/webAudioMainOut.js","../../../../../dev/core/dist/AudioV2/webAudio/webAudioUnmuteUI.js","../../../../../dev/core/dist/AudioV2/webAudio/webAudioEngine.js","../../../../../dev/core/dist/Audio/audioEngine.js"],"sourcesContent":["import { Observable } from \"../../Misc/observable\";\nexport var AudioNodeType;\n(function (AudioNodeType) {\n    AudioNodeType[AudioNodeType[\"HAS_INPUTS\"] = 1] = \"HAS_INPUTS\";\n    AudioNodeType[AudioNodeType[\"HAS_OUTPUTS\"] = 2] = \"HAS_OUTPUTS\";\n    AudioNodeType[AudioNodeType[\"HAS_INPUTS_AND_OUTPUTS\"] = 3] = \"HAS_INPUTS_AND_OUTPUTS\";\n})(AudioNodeType || (AudioNodeType = {}));\n/**\n * Abstract class for an audio node.\n *\n * An audio node is a processing unit that can receive audio data from an upstream node and/or send audio data to a\n * downstream node.\n *\n * Nodes can be connected to other nodes to create an audio graph. The audio graph represents the flow of audio data.\n *\n * There are 3 types of audio nodes:\n * 1. Input: Receives audio data from upstream nodes.\n * 2. Output: Sends audio data to downstream nodes.\n * 3. Input/Output: Receives audio data from upstream nodes and sends audio data to downstream nodes.\n */\nexport class AbstractAudioNode {\n    constructor(engine, nodeType) {\n        /**\n         * Observable for when the audio node is disposed.\n         */\n        this.onDisposeObservable = new Observable();\n        this.engine = engine;\n        if (nodeType & 1 /* AudioNodeType.HAS_INPUTS */) {\n            this._upstreamNodes = new Set();\n        }\n        if (nodeType & 2 /* AudioNodeType.HAS_OUTPUTS */) {\n            this._downstreamNodes = new Set();\n        }\n    }\n    /**\n     * Releases associated resources.\n     * - Triggers `onDisposeObservable`.\n     * @see {@link onDisposeObservable}\n     */\n    dispose() {\n        if (this._downstreamNodes) {\n            for (const node of Array.from(this._downstreamNodes)) {\n                if (!this._disconnect(node)) {\n                    throw new Error(\"Disconnect failed\");\n                }\n            }\n            this._downstreamNodes.clear();\n        }\n        if (this._upstreamNodes) {\n            for (const node of Array.from(this._upstreamNodes)) {\n                if (!node._disconnect(this)) {\n                    throw new Error(\"Disconnect failed\");\n                }\n            }\n            this._upstreamNodes.clear();\n        }\n        this.onDisposeObservable.notifyObservers(this);\n        this.onDisposeObservable.clear();\n    }\n    /**\n     * Connect to a downstream audio input node.\n     * @param node - The downstream audio input node to connect\n     * @returns `true` if the node is successfully connected; otherwise `false`\n     */\n    _connect(node) {\n        if (!this._downstreamNodes) {\n            return false;\n        }\n        if (this._downstreamNodes.has(node)) {\n            return false;\n        }\n        if (!node._onConnect(this)) {\n            return false;\n        }\n        this._downstreamNodes.add(node);\n        return true;\n    }\n    /**\n     * Disconnects a downstream audio input node.\n     * @param node - The downstream audio input node to disconnect\n     * @returns `true` if the node is successfully disconnected; otherwise `false`\n     */\n    _disconnect(node) {\n        if (!this._downstreamNodes) {\n            return false;\n        }\n        if (!this._downstreamNodes.delete(node)) {\n            return false;\n        }\n        return node._onDisconnect(this);\n    }\n    /**\n     * Called when an upstream audio output node is connecting.\n     * @param node - The connecting upstream audio node\n     * @returns `true` if the node is successfully connected; otherwise `false`\n     */\n    _onConnect(node) {\n        if (!this._upstreamNodes) {\n            return false;\n        }\n        if (this._upstreamNodes.has(node)) {\n            return false;\n        }\n        this._upstreamNodes.add(node);\n        return true;\n    }\n    /**\n     * Called when an upstream audio output node disconnects.\n     * @param node - The disconnecting upstream audio node\n     * @returns `true` if node is sucessfully disconnected; otherwise `false`\n     */\n    _onDisconnect(node) {\n        return this._upstreamNodes?.delete(node) ?? false;\n    }\n}\n/**\n * Abstract class for a named audio node.\n */\nexport class AbstractNamedAudioNode extends AbstractAudioNode {\n    constructor(name, engine, nodeType) {\n        super(engine, nodeType);\n        /**\n         * Observable for when the audio node is renamed.\n         */\n        this.onNameChangedObservable = new Observable();\n        this._name = name;\n    }\n    /**\n     * The name of the audio node.\n     * - Triggers `onNameChangedObservable` when changed.\n     * @see {@link onNameChangedObservable}\n     */\n    get name() {\n        return this._name;\n    }\n    set name(newName) {\n        if (this._name === newName) {\n            return;\n        }\n        const oldName = this._name;\n        this._name = newName;\n        this.onNameChangedObservable.notifyObservers({ newName, oldName, node: this });\n    }\n    dispose() {\n        super.dispose();\n        this.onNameChangedObservable.clear();\n    }\n}\n//# sourceMappingURL=abstractAudioNode.js.map","import { Quaternion, Vector3 } from \"../../../Maths/math.vector\";\n/**\n * Provides a common interface for attaching an audio listener or source to a specific entity, ensuring only one entity\n * is attached at a time.\n * @internal\n */\nexport class _SpatialAudioAttacherComponent {\n    /** @internal */\n    constructor(spatialAudioNode) {\n        /** @internal */\n        this._attachmentType = 3 /* SpatialAudioAttachmentType.PositionAndRotation */;\n        this._position = new Vector3();\n        this._rotationQuaternion = new Quaternion();\n        this._sceneNode = null;\n        this._useBoundingBox = false;\n        /**\n         * Releases associated resources.\n         */\n        this.dispose = () => {\n            this.detach();\n        };\n        this._spatialAudioNode = spatialAudioNode;\n    }\n    /**\n     * Returns `true` if attached to a scene node; otherwise returns `false`.\n     */\n    get isAttached() {\n        return this._sceneNode !== null;\n    }\n    /**\n     * Attaches to a scene node.\n     *\n     * Detaches automatically before attaching to the given scene node.\n     * If `sceneNode` is `null` it is the same as calling `detach()`.\n     *\n     * @param sceneNode The scene node to attach to, or `null` to detach.\n     * @param useBoundingBox Whether to use the scene node's bounding box for positioning. Defaults to `false`.\n     * @param attachmentType Whether to attach to the scene node's position and/or rotation. Defaults to `PositionAndRotation`.\n     */\n    attach(sceneNode, useBoundingBox, attachmentType) {\n        if (this._sceneNode === sceneNode) {\n            return;\n        }\n        this.detach();\n        if (!sceneNode) {\n            return;\n        }\n        this._attachmentType = attachmentType;\n        this._sceneNode = sceneNode;\n        this._sceneNode.onDisposeObservable.add(this.dispose);\n        this._useBoundingBox = useBoundingBox;\n    }\n    /**\n     * Detaches from the scene node if attached.\n     */\n    detach() {\n        this._sceneNode?.onDisposeObservable.removeCallback(this.dispose);\n        this._sceneNode = null;\n    }\n    /**\n     * Updates the position and rotation of the associated audio engine object in the audio rendering graph.\n     *\n     * This is called automatically by default and only needs to be called manually if automatic updates are disabled.\n     */\n    update() {\n        if (this._attachmentType & 1 /* SpatialAudioAttachmentType.Position */) {\n            if (this._useBoundingBox && this._sceneNode.getBoundingInfo) {\n                this._position.copyFrom(this._sceneNode.getBoundingInfo().boundingBox.centerWorld);\n            }\n            else {\n                this._sceneNode?.getWorldMatrix().getTranslationToRef(this._position);\n            }\n            this._spatialAudioNode.position.copyFrom(this._position);\n            this._spatialAudioNode._updatePosition();\n        }\n        if (this._attachmentType & 2 /* SpatialAudioAttachmentType.Rotation */) {\n            this._sceneNode?.getWorldMatrix().decompose(undefined, this._rotationQuaternion);\n            this._spatialAudioNode.rotationQuaternion.copyFrom(this._rotationQuaternion);\n            this._spatialAudioNode._updateRotation();\n        }\n    }\n}\n//# sourceMappingURL=spatialAudioAttacherComponent.js.map","export const _FileExtensionRegex = new RegExp(\"\\\\.(\\\\w{3,4})($|\\\\?)\");\nconst CurveLength = 100;\nconst TmpLineValues = new Float32Array([0, 0]);\nlet TmpCurveValues = null;\nlet ExpCurve = null;\nlet LogCurve = null;\n/**\n * @returns A Float32Array representing an exponential ramp from (0, 0) to (1, 1).\n */\nfunction GetExpCurve() {\n    if (!ExpCurve) {\n        ExpCurve = new Float32Array(CurveLength);\n        const increment = 1 / (CurveLength - 1);\n        let x = increment;\n        for (let i = 1; i < CurveLength; i++) {\n            ExpCurve[i] = Math.exp(-11.512925464970227 * (1 - x));\n            x += increment;\n        }\n    }\n    return ExpCurve;\n}\n/**\n * @returns A Float32Array representing a logarithmic ramp from (0, 0) to (1, 1).\n */\nfunction GetLogCurve() {\n    if (!LogCurve) {\n        LogCurve = new Float32Array(CurveLength);\n        const increment = 1 / CurveLength;\n        let x = increment;\n        for (let i = 0; i < CurveLength; i++) {\n            LogCurve[i] = 1 + Math.log10(x) / Math.log10(CurveLength);\n            x += increment;\n        }\n    }\n    return LogCurve;\n}\n/** @internal */\nexport function _GetAudioParamCurveValues(shape, from, to) {\n    if (!TmpCurveValues) {\n        TmpCurveValues = new Float32Array(CurveLength);\n    }\n    let normalizedCurve;\n    if (shape === \"linear\" /* AudioParameterRampShape.Linear */) {\n        TmpLineValues[0] = from;\n        TmpLineValues[1] = to;\n        return TmpLineValues;\n    }\n    else if (shape === \"exponential\" /* AudioParameterRampShape.Exponential */) {\n        normalizedCurve = GetExpCurve();\n    }\n    else if (shape === \"logarithmic\" /* AudioParameterRampShape.Logarithmic */) {\n        normalizedCurve = GetLogCurve();\n    }\n    else {\n        throw new Error(`Unknown ramp shape: ${shape}`);\n    }\n    const direction = Math.sign(to - from);\n    const range = Math.abs(to - from);\n    if (direction === 1) {\n        for (let i = 0; i < normalizedCurve.length; i++) {\n            TmpCurveValues[i] = from + range * normalizedCurve[i];\n        }\n    }\n    else {\n        let j = CurveLength - 1;\n        for (let i = 0; i < normalizedCurve.length; i++, j--) {\n            TmpCurveValues[i] = from - range * (1 - normalizedCurve[j]);\n        }\n    }\n    return TmpCurveValues;\n}\n/** @internal */\nexport function _CleanUrl(url) {\n    return url.replace(/#/gm, \"%23\");\n}\n//# sourceMappingURL=audioUtils.js.map","import { _GetAudioParamCurveValues } from \"../../audioUtils\";\n/**\n * Minimum duration in seconds for a ramp to be considered valid.\n *\n * If the duration is less than this value, the value will be set immediately instead of being ramped smoothly since\n * there is no perceptual difference for such short durations, so a ramp is not needed.\n */\nconst MinRampDuration = 0.000001;\n/** @internal */\nexport class _WebAudioParameterComponent {\n    /** @internal */\n    constructor(engine, param) {\n        this._rampEndTime = 0;\n        this._engine = engine;\n        this._param = param;\n        this._targetValue = param.value;\n    }\n    /** @internal */\n    get isRamping() {\n        return this._engine.currentTime < this._rampEndTime;\n    }\n    /** @internal */\n    get targetValue() {\n        return this._targetValue;\n    }\n    set targetValue(value) {\n        this.setTargetValue(value);\n    }\n    /** @internal */\n    get value() {\n        return this._param.value;\n    }\n    /** @internal */\n    dispose() {\n        this._param = null;\n        this._engine = null;\n    }\n    /**\n     * Sets the target value of the audio parameter with an optional ramping duration and shape.\n     *\n     * @internal\n     */\n    setTargetValue(value, options = null) {\n        const shape = typeof options?.shape === \"string\" ? options.shape : \"linear\" /* AudioParameterRampShape.Linear */;\n        const startTime = this._engine.currentTime;\n        if (shape === \"none\" /* AudioParameterRampShape.None */) {\n            this._param.cancelScheduledValues(0);\n            this._param.value = this._targetValue = value;\n            this._rampEndTime = startTime;\n            return;\n        }\n        let duration = typeof options?.duration === \"number\" ? Math.max(options.duration, this._engine.parameterRampDuration) : this._engine.parameterRampDuration;\n        if ((duration = Math.max(this._engine.parameterRampDuration, duration)) < MinRampDuration) {\n            this._param.setValueAtTime((this._targetValue = value), startTime);\n            return;\n        }\n        this._param.cancelScheduledValues(0);\n        this._param.setValueCurveAtTime(_GetAudioParamCurveValues(shape, this._param.value, (this._targetValue = value)), startTime, duration);\n        this._rampEndTime = startTime + duration;\n    }\n}\n//# sourceMappingURL=webAudioParameterComponent.js.map","import { PrecisionDate } from \"../../../Misc/precisionDate\";\n/** @internal */\nexport class _SpatialWebAudioUpdaterComponent {\n    /** @internal */\n    constructor(parent, autoUpdate, minUpdateTime) {\n        this._autoUpdate = true;\n        this._lastUpdateTime = 0;\n        /** @internal */\n        this.minUpdateTime = 0;\n        if (!autoUpdate) {\n            return;\n        }\n        this.minUpdateTime = minUpdateTime;\n        const update = () => {\n            if (!this._autoUpdate) {\n                return;\n            }\n            let skipUpdate = false;\n            if (0 < this.minUpdateTime) {\n                const now = PrecisionDate.Now;\n                if (this._lastUpdateTime && now - this._lastUpdateTime < this.minUpdateTime) {\n                    skipUpdate = true;\n                }\n                this._lastUpdateTime = now;\n            }\n            if (!skipUpdate) {\n                parent.update();\n            }\n            requestAnimationFrame(update);\n        };\n        requestAnimationFrame(update);\n    }\n    /** @internal */\n    dispose() {\n        this._autoUpdate = false;\n    }\n}\n//# sourceMappingURL=spatialWebAudioUpdaterComponent.js.map","const Instances = [];\n/**\n * Gets the most recently created v2 audio engine.\n * @returns The most recently created v2 audio engine.\n */\nexport function LastCreatedAudioEngine() {\n    if (Instances.length === 0) {\n        return null;\n    }\n    return Instances[Instances.length - 1];\n}\n/**\n * Abstract base class for v2 audio engines.\n *\n * A v2 audio engine based on the WebAudio API can be created with the {@link CreateAudioEngineAsync} function.\n */\nexport class AudioEngineV2 {\n    constructor(options) {\n        /** Not owned, but all items should be in `_nodes` container, too, which is owned. */\n        this._mainBuses = new Set();\n        this._sounds = new Set();\n        this._soundsArray = null;\n        /** Owned top-level sound and bus nodes. */\n        this._nodes = new Set();\n        this._defaultMainBus = null;\n        this._parameterRampDuration = 0.01;\n        Instances.push(this);\n        if (typeof options.parameterRampDuration === \"number\") {\n            this.parameterRampDuration = options.parameterRampDuration;\n        }\n    }\n    /**\n     * The default main bus that will be used for audio buses and sounds if their `outBus` option is not set.\n     * @see {@link IAudioBusOptions.outBus}\n     * @see {@link IAbstractSoundOptions.outBus}\n     */\n    get defaultMainBus() {\n        if (this._mainBuses.size === 0) {\n            return null;\n        }\n        if (!this._defaultMainBus) {\n            this._defaultMainBus = Array.from(this._mainBuses)[0];\n        }\n        return this._defaultMainBus;\n    }\n    /**\n     * The smoothing duration to use when changing audio parameters, in seconds. Defaults to `0.01` (10 milliseconds).\n     */\n    get parameterRampDuration() {\n        return this._parameterRampDuration;\n    }\n    set parameterRampDuration(value) {\n        this._parameterRampDuration = Math.max(0, value);\n    }\n    /**\n     * The list of static and streaming sounds created by the audio engine.\n     */\n    get sounds() {\n        if (!this._soundsArray) {\n            this._soundsArray = Array.from(this._sounds);\n        }\n        return this._soundsArray;\n    }\n    /**\n     * Releases associated resources.\n     */\n    dispose() {\n        if (Instances.includes(this)) {\n            Instances.splice(Instances.indexOf(this), 1);\n        }\n        const nodeIt = this._nodes.values();\n        for (let next = nodeIt.next(); !next.done; next = nodeIt.next()) {\n            next.value.dispose();\n        }\n        this._mainBuses.clear();\n        this._nodes.clear();\n        this._sounds.clear();\n        this._disposeSoundsArray();\n        this._defaultMainBus = null;\n    }\n    /**\n     * Unlocks the audio engine if it is locked.\n     * - Note that the returned promise may already be resolved if the audio engine is already unlocked.\n     * @returns A promise that is resolved when the audio engine is unlocked.\n     */\n    // eslint-disable-next-line @typescript-eslint/promise-function-async, no-restricted-syntax\n    unlockAsync() {\n        return this.resumeAsync();\n    }\n    _addMainBus(mainBus) {\n        this._mainBuses.add(mainBus);\n        this._addNode(mainBus);\n    }\n    _removeMainBus(mainBus) {\n        this._mainBuses.delete(mainBus);\n        this._defaultMainBus = null;\n        this._removeNode(mainBus);\n    }\n    _addNode(node) {\n        this._nodes.add(node);\n    }\n    _removeNode(node) {\n        this._nodes.delete(node);\n    }\n    _addSound(sound) {\n        this._disposeSoundsArray();\n        this._sounds.add(sound);\n        this._addNode(sound);\n    }\n    _removeSound(sound) {\n        this._disposeSoundsArray();\n        this._sounds.delete(sound);\n        this._removeNode(sound);\n    }\n    _disposeSoundsArray() {\n        if (this._soundsArray) {\n            this._soundsArray.length = 0;\n            this._soundsArray = null;\n        }\n    }\n}\n/**\n * @internal\n * @param engine - The given audio engine. If `null` then the last created audio engine is used.\n * @returns the given audio engine or the last created audio engine.\n * @throws An error if the resulting engine is `null`.\n */\nexport function _GetAudioEngine(engine) {\n    if (!engine) {\n        engine = LastCreatedAudioEngine();\n    }\n    if (engine) {\n        return engine;\n    }\n    throw new Error(\"No audio engine.\");\n}\n/**\n * Creates a new audio bus.\n * @param name - The name of the audio bus.\n * @param options - The options to use when creating the audio bus.\n * @param engine - The audio engine.\n * @returns A promise that resolves with the created audio bus.\n */\n// eslint-disable-next-line @typescript-eslint/promise-function-async, no-restricted-syntax\nexport function CreateAudioBusAsync(name, options = {}, engine = null) {\n    engine = _GetAudioEngine(engine);\n    return engine.createBusAsync(name, options);\n}\n/**\n * Creates a new main audio bus.\n * @param name - The name of the main audio bus.\n * @param options - The options to use when creating the main audio bus.\n * @param engine - The audio engine.\n * @returns A promise that resolves with the created main audio bus.\n */\n// eslint-disable-next-line @typescript-eslint/promise-function-async, no-restricted-syntax\nexport function CreateMainAudioBusAsync(name, options = {}, engine = null) {\n    engine = _GetAudioEngine(engine);\n    return engine.createMainBusAsync(name, options);\n}\n/**\n * Creates a new microphone sound source.\n * @param name - The name of the sound.\n * @param options - The options for the sound source.\n * @param engine - The audio engine.\n * @returns A promise that resolves to the created sound source.\n */\n// eslint-disable-next-line @typescript-eslint/promise-function-async, no-restricted-syntax\nexport function CreateMicrophoneSoundSourceAsync(name, options = {}, engine = null) {\n    engine = _GetAudioEngine(engine);\n    return engine.createMicrophoneSoundSourceAsync(name, options);\n}\n/**\n * Creates a new static sound.\n * @param name - The name of the sound.\n * @param source - The source of the sound.\n * @param options - The options for the static sound.\n * @param engine - The audio engine.\n * @returns A promise that resolves to the created static sound.\n */\n// eslint-disable-next-line @typescript-eslint/promise-function-async, no-restricted-syntax\nexport function CreateSoundAsync(name, source, options = {}, engine = null) {\n    engine = _GetAudioEngine(engine);\n    return engine.createSoundAsync(name, source, options);\n}\n/**\n * Creates a new static sound buffer.\n * @param source - The source of the sound buffer.\n * @param options - The options for the static sound buffer.\n * @param engine - The audio engine.\n * @returns A promise that resolves to the created static sound buffer.\n */\nexport async function CreateSoundBufferAsync(source, options = {}, engine = null) {\n    engine = _GetAudioEngine(engine);\n    return await engine.createSoundBufferAsync(source, options);\n}\n/**\n * Creates a new sound source.\n * @param name - The name of the sound.\n * @param source - The source of the sound.\n * @param options - The options for the sound source.\n * @param engine - The audio engine.\n * @returns A promise that resolves to the created sound source.\n */\n// eslint-disable-next-line @typescript-eslint/promise-function-async, no-restricted-syntax\nexport function CreateSoundSourceAsync(name, source, options = {}, engine = null) {\n    engine = _GetAudioEngine(engine);\n    return engine.createSoundSourceAsync(name, source, options);\n}\n/**\n * Creates a new streaming sound.\n * @param name - The name of the sound.\n * @param source - The source of the sound.\n * @param options - The options for the streaming sound.\n * @param engine - The audio engine.\n * @returns A promise that resolves to the created streaming sound.\n */\n// eslint-disable-next-line @typescript-eslint/promise-function-async, no-restricted-syntax\nexport function CreateStreamingSoundAsync(name, source, options = {}, engine = null) {\n    engine = _GetAudioEngine(engine);\n    return engine.createStreamingSoundAsync(name, source, options);\n}\n//# sourceMappingURL=audioEngineV2.js.map","import { Quaternion, Vector3 } from \"../../../Maths/math.vector\";\nexport const _SpatialAudioListenerDefaults = {\n    position: Vector3.Zero(),\n    rotation: Vector3.Zero(),\n    rotationQuaternion: new Quaternion(),\n};\n/**\n * @param options The spatial audio listener options to check.\n * @returns `true` if spatial audio listener options are defined, otherwise `false`.\n */\nexport function _HasSpatialAudioListenerOptions(options) {\n    return (options.listenerEnabled ||\n        options.listenerMinUpdateTime !== undefined ||\n        options.listenerPosition !== undefined ||\n        options.listenerRotation !== undefined ||\n        options.listenerRotationQuaternion !== undefined);\n}\n/**\n * Abstract class representing the spatial audio `listener` property on an audio engine.\n *\n * @see {@link AudioEngineV2.listener}\n */\nexport class AbstractSpatialAudioListener {\n}\n//# sourceMappingURL=abstractSpatialAudioListener.js.map","import { _SpatialAudioAttacherComponent } from \"../components/spatialAudioAttacherComponent\";\nimport { _SpatialAudioListenerDefaults, AbstractSpatialAudioListener } from \"./abstractSpatialAudioListener\";\n/** @internal */\nexport class _SpatialAudioListener extends AbstractSpatialAudioListener {\n    constructor() {\n        super();\n        this._attacherComponent = null;\n        this._attacherComponent = new _SpatialAudioAttacherComponent(this);\n    }\n    /** @internal */\n    get isAttached() {\n        return this._attacherComponent !== null && this._attacherComponent.isAttached;\n    }\n    /**\n     * Attaches to a scene node.\n     *\n     * Detaches automatically before attaching to the given scene node.\n     * If `sceneNode` is `null` it is the same as calling `detach()`.\n     *\n     * @param sceneNode The scene node to attach to, or `null` to detach.\n     * @param useBoundingBox Whether to use the bounding box of the node for positioning. Defaults to `false`.\n     * @param attachmentType Whether to attach to the node's position and/or rotation. Defaults to `PositionAndRotation`.\n     */\n    attach(sceneNode, useBoundingBox = false, attachmentType = 3 /* SpatialAudioAttachmentType.PositionAndRotation */) {\n        if (!this._attacherComponent) {\n            this._attacherComponent = new _SpatialAudioAttacherComponent(this);\n        }\n        this._attacherComponent.attach(sceneNode, useBoundingBox, attachmentType);\n    }\n    /**\n     * Detaches from the scene node if attached.\n     */\n    detach() {\n        this._attacherComponent?.detach();\n    }\n    /** @internal */\n    dispose() {\n        this._attacherComponent?.dispose();\n        this._attacherComponent = null;\n    }\n    /** @internal */\n    setOptions(options) {\n        if (options.listenerMinUpdateTime !== undefined) {\n            this.minUpdateTime = options.listenerMinUpdateTime;\n        }\n        if (options.listenerPosition) {\n            this.position = options.listenerPosition.clone();\n        }\n        if (options.listenerRotationQuaternion) {\n            this.rotationQuaternion = options.listenerRotationQuaternion.clone();\n        }\n        else if (options.listenerRotation) {\n            this.rotation = options.listenerRotation.clone();\n        }\n        else {\n            this.rotationQuaternion = _SpatialAudioListenerDefaults.rotationQuaternion.clone();\n        }\n        this.update();\n    }\n}\n//# sourceMappingURL=spatialAudioListener.js.map","import { Matrix, Quaternion, Vector3 } from \"../../../Maths/math.vector\";\nimport { _SpatialAudioListener } from \"../../abstractAudio/subProperties/spatialAudioListener\";\nimport { _SpatialWebAudioUpdaterComponent } from \"../components/spatialWebAudioUpdaterComponent\";\nimport { _WebAudioParameterComponent } from \"../components/webAudioParameterComponent\";\nconst TmpMatrix = Matrix.Zero();\nconst TmpQuaternion = new Quaternion();\nconst TmpVector1 = Vector3.Zero();\nconst TmpVector2 = Vector3.Zero();\n/** @internal */\nexport function _CreateSpatialAudioListener(engine, autoUpdate, minUpdateTime) {\n    const listener = engine._audioContext.listener;\n    if (listener.forwardX &&\n        listener.forwardY &&\n        listener.forwardZ &&\n        listener.positionX &&\n        listener.positionY &&\n        listener.positionZ &&\n        listener.upX &&\n        listener.upY &&\n        listener.upZ) {\n        return new _SpatialWebAudioListener(engine, autoUpdate, minUpdateTime);\n    }\n    else {\n        return new _SpatialWebAudioListenerFallback(engine, autoUpdate, minUpdateTime);\n    }\n}\nclass _AbstractSpatialWebAudioListener extends _SpatialAudioListener {\n    /** @internal */\n    constructor(engine, autoUpdate, minUpdateTime) {\n        super();\n        this._lastPosition = Vector3.Zero();\n        this._lastRotation = Vector3.Zero();\n        this._lastRotationQuaternion = new Quaternion();\n        /** @internal */\n        this.position = Vector3.Zero();\n        /** @internal */\n        this.rotation = Vector3.Zero();\n        /** @internal */\n        this.rotationQuaternion = new Quaternion();\n        this._listener = engine._audioContext.listener;\n        this.engine = engine;\n        this._updaterComponent = new _SpatialWebAudioUpdaterComponent(this, autoUpdate, minUpdateTime);\n    }\n    /** @internal */\n    dispose() {\n        super.dispose();\n        this._updaterComponent.dispose();\n        this._updaterComponent = null;\n    }\n    /** @internal */\n    get minUpdateTime() {\n        return this._updaterComponent.minUpdateTime;\n    }\n    /** @internal */\n    set minUpdateTime(value) {\n        this._updaterComponent.minUpdateTime = value;\n    }\n    /** @internal */\n    update() {\n        if (this.isAttached) {\n            this._attacherComponent?.update();\n        }\n        else {\n            this._updatePosition();\n            this._updateRotation();\n        }\n    }\n    _updatePosition() {\n        if (this._lastPosition.equalsWithEpsilon(this.position)) {\n            return;\n        }\n        this._setWebAudioPosition(this.position);\n        this._lastPosition.copyFrom(this.position);\n    }\n    _updateRotation() {\n        if (!this._lastRotationQuaternion.equalsWithEpsilon(this.rotationQuaternion)) {\n            TmpQuaternion.copyFrom(this.rotationQuaternion);\n            this._lastRotationQuaternion.copyFrom(this.rotationQuaternion);\n        }\n        else if (!this._lastRotation.equalsWithEpsilon(this.rotation)) {\n            Quaternion.FromEulerAnglesToRef(this.rotation.x, this.rotation.y, this.rotation.z, TmpQuaternion);\n            this._lastRotation.copyFrom(this.rotation);\n        }\n        else {\n            return;\n        }\n        Matrix.FromQuaternionToRef(TmpQuaternion, TmpMatrix);\n        // NB: The WebAudio API is right-handed.\n        Vector3.TransformNormalToRef(Vector3.RightHandedForwardReadOnly, TmpMatrix, TmpVector1);\n        Vector3.TransformNormalToRef(Vector3.Up(), TmpMatrix, TmpVector2);\n        this._setWebAudioOrientation(TmpVector1, TmpVector2);\n    }\n}\n/**\n * Full-featured spatial audio listener for the Web Audio API.\n *\n * Used in browsers that support the `forwardX/Y/Z`, `positionX/Y/Z`, and `upX/Y/Z` properties on the AudioContext listener.\n *\n * NB: Firefox falls back to using this implementation.\n *\n * @see _SpatialWebAudioListenerFallback for the implementation used if only `setPosition` and `setOrientation` are available.\n *\n * NB: This sub property is not backed by a sub node and all properties are set directly on the audio context listener.\n *\n * @internal\n */\nclass _SpatialWebAudioListener extends _AbstractSpatialWebAudioListener {\n    constructor(engine, autoUpdate, minUpdateTime) {\n        super(engine, autoUpdate, minUpdateTime);\n        const listener = engine._audioContext.listener;\n        this._forwardX = new _WebAudioParameterComponent(engine, listener.forwardX);\n        this._forwardY = new _WebAudioParameterComponent(engine, listener.forwardY);\n        this._forwardZ = new _WebAudioParameterComponent(engine, listener.forwardZ);\n        this._positionX = new _WebAudioParameterComponent(engine, listener.positionX);\n        this._positionY = new _WebAudioParameterComponent(engine, listener.positionY);\n        this._positionZ = new _WebAudioParameterComponent(engine, listener.positionZ);\n        this._upX = new _WebAudioParameterComponent(engine, listener.upX);\n        this._upY = new _WebAudioParameterComponent(engine, listener.upY);\n        this._upZ = new _WebAudioParameterComponent(engine, listener.upZ);\n    }\n    _setWebAudioPosition(position) {\n        // If attached and there is a ramp in progress, we assume another update is coming soon that we can wait for.\n        // We don't do this for unattached nodes because there may not be another update coming.\n        if (this.isAttached && (this._positionX.isRamping || this._positionY.isRamping || this._positionZ.isRamping)) {\n            return;\n        }\n        this._positionX.targetValue = position.x;\n        this._positionY.targetValue = position.y;\n        this._positionZ.targetValue = position.z;\n    }\n    _setWebAudioOrientation(forward, up) {\n        // If attached and there is a ramp in progress, we assume another update is coming soon that we can wait for.\n        // We don't do this for unattached nodes because there may not be another update coming.\n        if (this.isAttached &&\n            (this._forwardX.isRamping || this._forwardY.isRamping || this._forwardZ.isRamping || this._upX.isRamping || this._upY.isRamping || this._upZ.isRamping)) {\n            return;\n        }\n        this._forwardX.targetValue = forward.x;\n        this._forwardY.targetValue = forward.y;\n        this._forwardZ.targetValue = forward.z;\n        this._upX.targetValue = up.x;\n        this._upY.targetValue = up.y;\n        this._upZ.targetValue = up.z;\n    }\n}\n/**\n * Fallback spatial audio listener for the Web Audio API.\n *\n * Used in browsers that do not support the `forwardX/Y/Z`, `positionX/Y/Z`, and `upX/Y/Z` properties on the\n * AudioContext listener.\n *\n * @see _SpatialWebAudioListener for the implementation used if the `forwardX/Y/Z`, `positionX/Y/Z`, and `upX/Y/Z`\n * properties are available.\n *\n * NB: This sub property is not backed by a sub node and all properties are set directly on the audio context listener.\n *\n * @internal\n */\nclass _SpatialWebAudioListenerFallback extends _AbstractSpatialWebAudioListener {\n    _setWebAudioPosition(position) {\n        this._listener.setPosition(position.x, position.y, position.z);\n    }\n    _setWebAudioOrientation(forward, up) {\n        this._listener.setOrientation(forward.x, forward.y, forward.z, up.x, up.y, up.z);\n    }\n}\n//# sourceMappingURL=spatialWebAudioListener.js.map","import { AbstractAudioNode } from \"./abstractAudioNode\";\n/**\n * Abstract class for the main audio output node.\n *\n * A main audio output is the last audio node in the audio graph before the audio is sent to the speakers.\n *\n * @see {@link AudioEngineV2.mainOut}\n * @internal\n */\nexport class _MainAudioOut extends AbstractAudioNode {\n    constructor(engine) {\n        super(engine, 1 /* AudioNodeType.HAS_INPUTS */);\n    }\n}\n//# sourceMappingURL=mainAudioOut.js.map","import { _MainAudioOut } from \"../abstractAudio/mainAudioOut\";\nimport { _WebAudioParameterComponent } from \"./components/webAudioParameterComponent\";\n/** @internal */\nexport class _WebAudioMainOut extends _MainAudioOut {\n    /** @internal */\n    constructor(engine) {\n        super(engine);\n        this._setGainNode(new GainNode(engine._audioContext));\n    }\n    /** @internal */\n    dispose() {\n        super.dispose();\n        this._volume.dispose();\n        this._gainNode.disconnect();\n        this._destinationNode.disconnect();\n    }\n    /** @internal */\n    get _inNode() {\n        return this._gainNode;\n    }\n    set _inNode(value) {\n        if (this._gainNode === value) {\n            return;\n        }\n        this._setGainNode(value);\n    }\n    /** @internal */\n    get volume() {\n        return this._volume.targetValue;\n    }\n    /** @internal */\n    set volume(value) {\n        this._volume.targetValue = value;\n    }\n    get _destinationNode() {\n        return this.engine._audioDestination;\n    }\n    /** @internal */\n    getClassName() {\n        return \"_WebAudioMainOut\";\n    }\n    /** @internal */\n    setVolume(value, options = null) {\n        this._volume.setTargetValue(value, options);\n    }\n    _setGainNode(gainNode) {\n        if (this._gainNode === gainNode) {\n            return;\n        }\n        this._gainNode?.disconnect();\n        gainNode.connect(this._destinationNode);\n        this._volume = new _WebAudioParameterComponent(this.engine, gainNode.gain);\n        this._gainNode = gainNode;\n    }\n}\n//# sourceMappingURL=webAudioMainOut.js.map","import { EngineStore } from \"../../Engines/engineStore\";\n/**\n * Adds a UI button that starts the audio engine's underlying audio context when the user presses it.\n * @internal\n */\nexport class _WebAudioUnmuteUI {\n    /** @internal */\n    constructor(engine, parentElement) {\n        this._button = null;\n        this._enabled = true;\n        this._style = null;\n        this._onStateChanged = () => {\n            if (!this._button) {\n                return;\n            }\n            if (this._engine.state === \"running\") {\n                this._hide();\n            }\n            else {\n                this._show();\n            }\n        };\n        this._engine = engine;\n        const parent = parentElement || EngineStore.LastCreatedEngine?.getInputElement()?.parentElement || document.body;\n        const top = (parent?.offsetTop || 0) + 20;\n        this._style = document.createElement(\"style\");\n        this._style.appendChild(document.createTextNode(`.babylonUnmute{position:absolute;top:${top}px;margin-left:20px;height:40px;width:60px;background-color:rgba(51,51,51,0.7);background-image:url(\"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E\");background-size:80%;background-repeat:no-repeat;background-position:center;background-position-y:4px;border:none;outline:none;transition:transform 0.125s ease-out;cursor:pointer;z-index:9999;}.babylonUnmute:hover{transform:scale(1.05)}`));\n        document.head.appendChild(this._style);\n        this._button = document.createElement(\"button\");\n        this._button.className = \"babylonUnmute\";\n        this._button.id = \"babylonUnmuteButton\";\n        this._button.addEventListener(\"click\", () => {\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this._engine.unlockAsync();\n        });\n        parent.appendChild(this._button);\n        this._engine.stateChangedObservable.add(this._onStateChanged);\n    }\n    /** @internal */\n    dispose() {\n        this._button?.remove();\n        this._button = null;\n        this._style?.remove();\n        this._style = null;\n        this._engine.stateChangedObservable.removeCallback(this._onStateChanged);\n    }\n    /** @internal */\n    get enabled() {\n        return this._enabled;\n    }\n    set enabled(value) {\n        this._enabled = value;\n        if (value) {\n            if (this._engine.state !== \"running\") {\n                this._show();\n            }\n        }\n        else {\n            this._hide();\n        }\n    }\n    _show() {\n        if (!this._button || !this._enabled) {\n            return;\n        }\n        this._button.style.display = \"block\";\n    }\n    _hide() {\n        if (!this._button) {\n            return;\n        }\n        this._button.style.display = \"none\";\n    }\n}\n//# sourceMappingURL=webAudioUnmuteUI.js.map","import { Observable } from \"../../Misc/observable\";\nimport { AudioEngineV2 } from \"../abstractAudio/audioEngineV2\";\nimport { _HasSpatialAudioListenerOptions } from \"../abstractAudio/subProperties/abstractSpatialAudioListener\";\nimport { _CreateSpatialAudioListener } from \"./subProperties/spatialWebAudioListener\";\nimport { _WebAudioMainOut } from \"./webAudioMainOut\";\nimport { _WebAudioUnmuteUI } from \"./webAudioUnmuteUI\";\n/**\n * Creates a new v2 audio engine that uses the WebAudio API.\n * @param options - The options for creating the audio engine.\n * @returns A promise that resolves with the created audio engine.\n */\nexport async function CreateAudioEngineAsync(options = {}) {\n    const engine = new _WebAudioEngine(options);\n    await engine._initAsync(options);\n    return engine;\n}\nconst FormatMimeTypes = {\n    aac: \"audio/aac\",\n    ac3: \"audio/ac3\",\n    flac: \"audio/flac\",\n    m4a: \"audio/mp4\",\n    mp3: 'audio/mpeg; codecs=\"mp3\"',\n    mp4: \"audio/mp4\",\n    ogg: 'audio/ogg; codecs=\"vorbis\"',\n    wav: \"audio/wav\",\n    webm: 'audio/webm; codecs=\"vorbis\"',\n};\n/** @internal */\nexport class _WebAudioEngine extends AudioEngineV2 {\n    /** @internal */\n    constructor(options = {}) {\n        super(options);\n        this._audioContextStarted = false;\n        this._destinationNode = null;\n        this._invalidFormats = new Set();\n        this._isUpdating = false;\n        this._listener = null;\n        this._listenerAutoUpdate = true;\n        this._listenerMinUpdateTime = 0;\n        this._pauseCalled = false;\n        this._resumeOnInteraction = true;\n        this._resumeOnPause = true;\n        this._resumeOnPauseRetryInterval = 1000;\n        this._resumeOnPauseTimerId = null;\n        this._resumePromise = null;\n        this._silentHtmlAudio = null;\n        this._unmuteUI = null;\n        this._updateObservable = null;\n        this._validFormats = new Set();\n        this._volume = 1;\n        /** @internal */\n        this._isUsingOfflineAudioContext = false;\n        /** @internal */\n        this.isReadyPromise = new Promise((resolve) => {\n            this._resolveIsReadyPromise = resolve;\n        });\n        /** @internal */\n        this.stateChangedObservable = new Observable();\n        /** @internal */\n        this.userGestureObservable = new Observable();\n        this._initAudioContextAsync = async () => {\n            this._audioContext.addEventListener(\"statechange\", this._onAudioContextStateChange);\n            this._mainOut = new _WebAudioMainOut(this);\n            this._mainOut.volume = this._volume;\n            await this.createMainBusAsync(\"default\");\n        };\n        this._onAudioContextStateChange = () => {\n            if (this.state === \"running\") {\n                clearInterval(this._resumeOnPauseTimerId);\n                this._audioContextStarted = true;\n                this._resumePromise = null;\n            }\n            if (this.state === \"suspended\" || this.state === \"interrupted\") {\n                if (this._audioContextStarted && this._resumeOnPause && !this._pauseCalled) {\n                    clearInterval(this._resumeOnPauseTimerId);\n                    this._resumeOnPauseTimerId = setInterval(() => {\n                        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                        this.resumeAsync();\n                    }, this._resumeOnPauseRetryInterval);\n                }\n            }\n            this.stateChangedObservable.notifyObservers(this.state);\n        };\n        this._onUserGestureAsync = async () => {\n            if (this._resumeOnInteraction) {\n                await this._audioContext.resume();\n            }\n            // On iOS the ringer switch must be turned on for WebAudio to play.\n            // This gets WebAudio to play with the ringer switch turned off by playing an HTMLAudioElement.\n            if (!this._silentHtmlAudio) {\n                this._silentHtmlAudio = document.createElement(\"audio\");\n                const audio = this._silentHtmlAudio;\n                audio.controls = false;\n                audio.preload = \"auto\";\n                audio.loop = true;\n                // Wave data for 0.0001 seconds of silence.\n                audio.src = \"data:audio/wav;base64,UklGRjAAAABXQVZFZm10IBAAAAABAAEAgLsAAAB3AQACABAAZGF0YQwAAAAAAAEA/v8CAP//AQA=\";\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                audio.play();\n            }\n            this.userGestureObservable.notifyObservers();\n        };\n        this._startUpdating = () => {\n            if (this._isUpdating) {\n                return;\n            }\n            this._isUpdating = true;\n            if (this.state === \"running\") {\n                this._update();\n            }\n            else {\n                const callback = () => {\n                    if (this.state === \"running\") {\n                        this._update();\n                        this.stateChangedObservable.removeCallback(callback);\n                    }\n                };\n                this.stateChangedObservable.add(callback);\n            }\n        };\n        this._update = () => {\n            if (this._updateObservable?.hasObservers()) {\n                this._updateObservable.notifyObservers();\n                requestAnimationFrame(this._update);\n            }\n            else {\n                this._isUpdating = false;\n            }\n        };\n        if (typeof options.listenerAutoUpdate === \"boolean\") {\n            this._listenerAutoUpdate = options.listenerAutoUpdate;\n        }\n        if (typeof options.listenerMinUpdateTime === \"number\") {\n            this._listenerMinUpdateTime = options.listenerMinUpdateTime;\n        }\n        this._volume = options.volume ?? 1;\n        if (options.audioContext) {\n            this._isUsingOfflineAudioContext = options.audioContext instanceof OfflineAudioContext;\n            this._audioContext = options.audioContext;\n        }\n        else {\n            this._audioContext = new AudioContext();\n        }\n        if (!options.disableDefaultUI) {\n            this._unmuteUI = new _WebAudioUnmuteUI(this, options.defaultUIParentElement);\n        }\n    }\n    /** @internal */\n    async _initAsync(options) {\n        this._resumeOnInteraction = typeof options.resumeOnInteraction === \"boolean\" ? options.resumeOnInteraction : true;\n        this._resumeOnPause = typeof options.resumeOnPause === \"boolean\" ? options.resumeOnPause : true;\n        this._resumeOnPauseRetryInterval = options.resumeOnPauseRetryInterval ?? 1000;\n        document.addEventListener(\"click\", this._onUserGestureAsync);\n        await this._initAudioContextAsync();\n        if (_HasSpatialAudioListenerOptions(options)) {\n            this._listener = _CreateSpatialAudioListener(this, this._listenerAutoUpdate, this._listenerMinUpdateTime);\n            this._listener.setOptions(options);\n        }\n        this._resolveIsReadyPromise();\n    }\n    /** @internal */\n    get currentTime() {\n        return this._audioContext.currentTime ?? 0;\n    }\n    /** @internal */\n    get _inNode() {\n        return this._audioContext.destination;\n    }\n    /** @internal */\n    get mainOut() {\n        return this._mainOut;\n    }\n    /** @internal */\n    get listener() {\n        return this._listener ?? (this._listener = _CreateSpatialAudioListener(this, this._listenerAutoUpdate, this._listenerMinUpdateTime));\n    }\n    /** @internal */\n    get state() {\n        // Always return \"running\" for OfflineAudioContext so sound `play` calls work while the context is suspended.\n        return this._isUsingOfflineAudioContext ? \"running\" : this._audioContext.state;\n    }\n    /** @internal */\n    get volume() {\n        return this._volume;\n    }\n    /** @internal */\n    set volume(value) {\n        if (this._volume === value) {\n            return;\n        }\n        this._volume = value;\n        if (this._mainOut) {\n            this._mainOut.volume = value;\n        }\n    }\n    /**\n     * This property should only be used by the legacy audio engine.\n     * @internal\n     * */\n    get _audioDestination() {\n        return this._destinationNode ? this._destinationNode : (this._destinationNode = this._audioContext.destination);\n    }\n    set _audioDestination(value) {\n        this._destinationNode = value;\n    }\n    /**\n     * This property should only be used by the legacy audio engine.\n     * @internal\n     */\n    get _unmuteUIEnabled() {\n        return this._unmuteUI ? this._unmuteUI.enabled : false;\n    }\n    set _unmuteUIEnabled(value) {\n        if (this._unmuteUI) {\n            this._unmuteUI.enabled = value;\n        }\n    }\n    /** @internal */\n    async createBusAsync(name, options = {}) {\n        const module = await import(\"./webAudioBus\");\n        const bus = new module._WebAudioBus(name, this, options);\n        await bus._initAsync(options);\n        return bus;\n    }\n    /** @internal */\n    async createMainBusAsync(name, options = {}) {\n        const module = await import(\"./webAudioMainBus\");\n        const bus = new module._WebAudioMainBus(name, this);\n        await bus._initAsync(options);\n        return bus;\n    }\n    /** @internal */\n    async createMicrophoneSoundSourceAsync(name, options) {\n        let mediaStream;\n        try {\n            mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });\n        }\n        catch (e) {\n            throw new Error(\"Unable to access microphone: \" + e);\n        }\n        return await this.createSoundSourceAsync(name, new MediaStreamAudioSourceNode(this._audioContext, { mediaStream }), {\n            outBusAutoDefault: false,\n            ...options,\n        });\n    }\n    /** @internal */\n    async createSoundAsync(name, source, options = {}) {\n        const module = await import(\"./webAudioStaticSound\");\n        const sound = new module._WebAudioStaticSound(name, this, options);\n        await sound._initAsync(source, options);\n        return sound;\n    }\n    /** @internal */\n    async createSoundBufferAsync(source, options = {}) {\n        const module = await import(\"./webAudioStaticSound\");\n        const soundBuffer = new module._WebAudioStaticSoundBuffer(this);\n        await soundBuffer._initAsync(source, options);\n        return soundBuffer;\n    }\n    /** @internal */\n    async createSoundSourceAsync(name, source, options = {}) {\n        const module = await import(\"./webAudioSoundSource\");\n        const soundSource = new module._WebAudioSoundSource(name, source, this, options);\n        await soundSource._initAsync(options);\n        return soundSource;\n    }\n    /** @internal */\n    async createStreamingSoundAsync(name, source, options = {}) {\n        const module = await import(\"./webAudioStreamingSound\");\n        const sound = new module._WebAudioStreamingSound(name, this, options);\n        await sound._initAsync(source, options);\n        return sound;\n    }\n    /** @internal */\n    dispose() {\n        super.dispose();\n        this._listener?.dispose();\n        this._listener = null;\n        // Note that OfflineAudioContext does not have a `close` method.\n        if (this._audioContext.state !== \"closed\" && !this._isUsingOfflineAudioContext) {\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this._audioContext.close();\n        }\n        document.removeEventListener(\"click\", this._onUserGestureAsync);\n        this._audioContext.removeEventListener(\"statechange\", this._onAudioContextStateChange);\n        this._silentHtmlAudio?.remove();\n        this._updateObservable?.clear();\n        this._updateObservable = null;\n        this._unmuteUI?.dispose();\n        this._unmuteUI = null;\n        this.stateChangedObservable.clear();\n    }\n    /** @internal */\n    flagInvalidFormat(format) {\n        this._invalidFormats.add(format);\n    }\n    /** @internal */\n    isFormatValid(format) {\n        if (this._validFormats.has(format)) {\n            return true;\n        }\n        if (this._invalidFormats.has(format)) {\n            return false;\n        }\n        const mimeType = FormatMimeTypes[format];\n        if (mimeType === undefined) {\n            return false;\n        }\n        const audio = new Audio();\n        if (audio.canPlayType(mimeType) === \"\") {\n            this._invalidFormats.add(format);\n            return false;\n        }\n        this._validFormats.add(format);\n        return true;\n    }\n    /** @internal */\n    async pauseAsync() {\n        await this._audioContext.suspend();\n        this._pauseCalled = true;\n    }\n    /** @internal */\n    // eslint-disable-next-line @typescript-eslint/promise-function-async, no-restricted-syntax\n    resumeAsync() {\n        this._pauseCalled = false;\n        if (this._resumePromise) {\n            return this._resumePromise;\n        }\n        this._resumePromise = this._audioContext.resume();\n        this.stateChangedObservable.notifyObservers(this.state);\n        return this._resumePromise;\n    }\n    /** @internal */\n    setVolume(value, options = null) {\n        if (this._mainOut) {\n            this._mainOut.setVolume(value, options);\n        }\n        else {\n            throw new Error(\"Main output not initialized yet.\");\n        }\n    }\n    /** @internal */\n    _addMainBus(mainBus) {\n        super._addMainBus(mainBus);\n    }\n    /** @internal */\n    _removeMainBus(mainBus) {\n        super._removeMainBus(mainBus);\n    }\n    /** @internal */\n    _addNode(node) {\n        super._addNode(node);\n    }\n    /** @internal */\n    _removeNode(node) {\n        super._removeNode(node);\n    }\n    /** @internal */\n    _addSound(sound) {\n        super._addSound(sound);\n    }\n    /** @internal */\n    _removeSound(sound) {\n        super._removeSound(sound);\n    }\n    /** @internal */\n    _addUpdateObserver(callback) {\n        if (!this._updateObservable) {\n            this._updateObservable = new Observable();\n        }\n        this._updateObservable.add(callback);\n        this._startUpdating();\n    }\n    _removeUpdateObserver(callback) {\n        if (this._updateObservable) {\n            this._updateObservable.removeCallback(callback);\n        }\n    }\n}\n//# sourceMappingURL=webAudioEngine.js.map","import { _WebAudioEngine } from \"../AudioV2/webAudio/webAudioEngine\";\nimport { AbstractEngine } from \"../Engines/abstractEngine\";\nimport { Observable } from \"../Misc/observable\";\n// Sets the default audio engine to Babylon.js\nAbstractEngine.AudioEngineFactory = (hostElement, audioContext, audioDestination) => {\n    return new AudioEngine(hostElement, audioContext, audioDestination);\n};\n/**\n * This represents the default audio engine used in babylon.\n * It is responsible to play, synchronize and analyse sounds throughout the  application.\n * @see https://doc.babylonjs.com/features/featuresDeepDive/audio/playingSoundsMusic\n */\nexport class AudioEngine {\n    /**\n     * The master gain node defines the global audio volume of your audio engine.\n     */\n    get masterGain() {\n        return this._masterGain;\n    }\n    set masterGain(value) {\n        this._masterGain = this._v2.mainOut._inNode = value;\n    }\n    /**\n     * Defines if the audio engine relies on a custom unlocked button.\n     * In this case, the embedded button will not be displayed.\n     */\n    get useCustomUnlockedButton() {\n        return this._useCustomUnlockedButton;\n    }\n    set useCustomUnlockedButton(value) {\n        this._useCustomUnlockedButton = value;\n        this._v2._unmuteUIEnabled = !value;\n    }\n    /**\n     * Gets the current AudioContext if available.\n     */\n    get audioContext() {\n        if (this._v2.state === \"running\") {\n            // Do not wait for the promise to unlock.\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this._triggerRunningStateAsync();\n        }\n        return this._v2._audioContext;\n    }\n    /**\n     * Instantiates a new audio engine.\n     *\n     * @param hostElement defines the host element where to display the mute icon if necessary\n     * @param audioContext defines the audio context to be used by the audio engine\n     * @param audioDestination defines the audio destination node to be used by audio engine\n     */\n    constructor(hostElement = null, audioContext = null, audioDestination = null) {\n        this._tryToRun = false;\n        this._useCustomUnlockedButton = false;\n        /**\n         * Gets whether the current host supports Web Audio and thus could create AudioContexts.\n         */\n        this.canUseWebAudio = true;\n        /**\n         * Defines if Babylon should emit a warning if WebAudio is not supported.\n         */\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        this.WarnedWebAudioUnsupported = false;\n        /**\n         * Gets whether or not mp3 are supported by your browser.\n         */\n        this.isMP3supported = false;\n        /**\n         * Gets whether or not ogg are supported by your browser.\n         */\n        this.isOGGsupported = false;\n        /**\n         * Gets whether audio has been unlocked on the device.\n         * Some Browsers have strong restrictions about Audio and won't autoplay unless\n         * a user interaction has happened.\n         */\n        this.unlocked = false;\n        /**\n         * Event raised when audio has been unlocked on the browser.\n         */\n        this.onAudioUnlockedObservable = new Observable();\n        /**\n         * Event raised when audio has been locked on the browser.\n         */\n        this.onAudioLockedObservable = new Observable();\n        const v2 = new _WebAudioEngine({\n            audioContext: audioContext ? audioContext : undefined,\n            defaultUIParentElement: hostElement?.parentElement ? hostElement.parentElement : undefined,\n        });\n        // Historically the unmute button is disabled until a sound tries to play and can't, which results in a call\n        // to `AudioEngine.lock()`, which is where the unmute button is enabled if no custom UI is requested.\n        v2._unmuteUIEnabled = false;\n        this._masterGain = new GainNode(v2._audioContext);\n        v2._audioDestination = audioDestination;\n        v2.stateChangedObservable.add((state) => {\n            if (state === \"running\") {\n                this.unlocked = true;\n                this.onAudioUnlockedObservable.notifyObservers(this);\n            }\n            else {\n                this.unlocked = false;\n                this.onAudioLockedObservable.notifyObservers(this);\n            }\n        });\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises, github/no-then\n        v2._initAsync({ resumeOnInteraction: false }).then(() => {\n            const mainBusOutNode = v2.defaultMainBus._outNode;\n            if (mainBusOutNode) {\n                mainBusOutNode.disconnect(v2.mainOut._inNode);\n                mainBusOutNode.connect(this._masterGain);\n            }\n            v2.mainOut._inNode = this._masterGain;\n            v2.stateChangedObservable.notifyObservers(v2.state);\n        });\n        this.isMP3supported = v2.isFormatValid(\"mp3\");\n        this.isOGGsupported = v2.isFormatValid(\"ogg\");\n        this._v2 = v2;\n    }\n    /**\n     * Flags the audio engine in Locked state.\n     * This happens due to new browser policies preventing audio to autoplay.\n     */\n    lock() {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this._v2._audioContext.suspend();\n        if (!this._useCustomUnlockedButton) {\n            this._v2._unmuteUIEnabled = true;\n        }\n    }\n    /**\n     * Unlocks the audio engine once a user action has been done on the dom.\n     * This is helpful to resume play once browser policies have been satisfied.\n     */\n    unlock() {\n        if (this._v2._audioContext?.state === \"running\") {\n            if (!this.unlocked) {\n                // Notify users that the audio stack is unlocked/unmuted\n                this.unlocked = true;\n                this.onAudioUnlockedObservable.notifyObservers(this);\n            }\n            return;\n        }\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this._triggerRunningStateAsync();\n    }\n    /** @internal */\n    _resumeAudioContextOnStateChange() {\n        this._v2._audioContext?.addEventListener(\"statechange\", () => {\n            if (this.unlocked && this._v2._audioContext?.state !== \"running\") {\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                this._resumeAudioContextAsync();\n            }\n        }, {\n            once: true,\n            passive: true,\n            signal: AbortSignal.timeout(3000),\n        });\n    }\n    // eslint-disable-next-line @typescript-eslint/promise-function-async, no-restricted-syntax\n    _resumeAudioContextAsync() {\n        if (this._v2._isUsingOfflineAudioContext) {\n            return Promise.resolve();\n        }\n        if (this._v2._audioContext.state === \"suspended\" && !this._useCustomUnlockedButton) {\n            this._v2._unmuteUIEnabled = true;\n        }\n        return this._v2._audioContext.resume();\n    }\n    /**\n     * Destroy and release the resources associated with the audio context.\n     */\n    dispose() {\n        this._v2.dispose();\n        this.onAudioUnlockedObservable.clear();\n        this.onAudioLockedObservable.clear();\n    }\n    /**\n     * Gets the global volume sets on the master gain.\n     * @returns the global volume if set or -1 otherwise\n     */\n    getGlobalVolume() {\n        return this.masterGain.gain.value;\n    }\n    /**\n     * Sets the global volume of your experience (sets on the master gain).\n     * @param newVolume Defines the new global volume of the application\n     */\n    setGlobalVolume(newVolume) {\n        this.masterGain.gain.value = newVolume;\n    }\n    /**\n     * Connect the audio engine to an audio analyser allowing some amazing\n     * synchronization between the sounds/music and your visualization (VuMeter for instance).\n     * @see https://doc.babylonjs.com/features/featuresDeepDive/audio/playingSoundsMusic#using-the-analyser\n     * @param analyser The analyser to connect to the engine\n     */\n    connectToAnalyser(analyser) {\n        if (this._connectedAnalyser) {\n            this._connectedAnalyser.stopDebugCanvas();\n        }\n        this._connectedAnalyser = analyser;\n        this.masterGain.disconnect();\n        this._connectedAnalyser.connectAudioNodes(this.masterGain, this._v2._audioContext.destination);\n    }\n    async _triggerRunningStateAsync() {\n        if (this._tryToRun) {\n            void this._v2._audioContext.resume();\n            return;\n        }\n        this._tryToRun = true;\n        await this._resumeAudioContextAsync();\n        this._tryToRun = false;\n        this.unlocked = true;\n        this.onAudioUnlockedObservable.notifyObservers(this);\n    }\n}\n//# sourceMappingURL=audioEngine.js.map"],"names":["AudioNodeType","AbstractAudioNode","constructor","engine","nodeType","this","onDisposeObservable","Observable","_upstreamNodes","Set","_downstreamNodes","dispose","node","Array","from","_disconnect","Error","clear","notifyObservers","_connect","has","_onConnect","add","delete","_onDisconnect","AbstractNamedAudioNode","name","super","onNameChangedObservable","_name","newName","oldName","_SpatialAudioAttacherComponent","spatialAudioNode","_attachmentType","_position","Vector3","_rotationQuaternion","Quaternion","_sceneNode","_useBoundingBox","detach","_spatialAudioNode","isAttached","attach","sceneNode","useBoundingBox","attachmentType","removeCallback","update","getBoundingInfo","copyFrom","boundingBox","centerWorld","getWorldMatrix","getTranslationToRef","position","_updatePosition","decompose","undefined","rotationQuaternion","_updateRotation","_FileExtensionRegex","RegExp","CurveLength","TmpLineValues","Float32Array","TmpCurveValues","ExpCurve","LogCurve","_GetAudioParamCurveValues","shape","to","normalizedCurve","increment","x","i","Math","exp","GetExpCurve","log10","GetLogCurve","direction","sign","range","abs","length","j","_CleanUrl","url","replace","_WebAudioParameterComponent","param","_rampEndTime","_engine","_param","_targetValue","value","isRamping","currentTime","targetValue","setTargetValue","options","startTime","cancelScheduledValues","duration","max","parameterRampDuration","setValueAtTime","setValueCurveAtTime","_SpatialWebAudioUpdaterComponent","parent","autoUpdate","minUpdateTime","_autoUpdate","_lastUpdateTime","skipUpdate","now","PrecisionDate","Now","requestAnimationFrame","AudioEngineV2","_mainBuses","_sounds","_soundsArray","_nodes","_defaultMainBus","_parameterRampDuration","defaultMainBus","size","sounds","nodeIt","values","next","done","_disposeSoundsArray","unlockAsync","resumeAsync","_addMainBus","mainBus","_addNode","_removeMainBus","_removeNode","_addSound","sound","_removeSound","_SpatialAudioListenerDefaults","Zero","rotation","AbstractSpatialAudioListener","_SpatialAudioListener","_attacherComponent","setOptions","listenerMinUpdateTime","listenerPosition","clone","listenerRotationQuaternion","listenerRotation","TmpMatrix","Matrix","TmpQuaternion","TmpVector1","TmpVector2","_CreateSpatialAudioListener","listener","_audioContext","forwardX","forwardY","forwardZ","positionX","positionY","positionZ","upX","upY","upZ","_SpatialWebAudioListener","_SpatialWebAudioListenerFallback","_AbstractSpatialWebAudioListener","_lastPosition","_lastRotation","_lastRotationQuaternion","_listener","_updaterComponent","equalsWithEpsilon","_setWebAudioPosition","FromEulerAnglesToRef","y","z","FromQuaternionToRef","TransformNormalToRef","RightHandedForwardReadOnly","Up","_setWebAudioOrientation","_forwardX","_forwardY","_forwardZ","_positionX","_positionY","_positionZ","_upX","_upY","_upZ","forward","up","setPosition","setOrientation","_MainAudioOut","_WebAudioMainOut","_setGainNode","GainNode","_volume","_gainNode","disconnect","_destinationNode","_inNode","volume","_audioDestination","getClassName","setVolume","gainNode","connect","gain","_WebAudioUnmuteUI","parentElement","_button","_enabled","_style","_onStateChanged","state","_hide","_show","EngineStore","LastCreatedEngine","getInputElement","document","body","top","offsetTop","createElement","appendChild","createTextNode","head","className","id","addEventListener","stateChangedObservable","remove","enabled","style","display","FormatMimeTypes","aac","ac3","flac","m4a","mp3","mp4","ogg","wav","webm","_WebAudioEngine","_audioContextStarted","_invalidFormats","_isUpdating","_listenerAutoUpdate","_listenerMinUpdateTime","_pauseCalled","_resumeOnInteraction","_resumeOnPause","_resumeOnPauseRetryInterval","_resumeOnPauseTimerId","_resumePromise","_silentHtmlAudio","_unmuteUI","_updateObservable","_validFormats","_isUsingOfflineAudioContext","isReadyPromise","Promise","resolve","_resolveIsReadyPromise","userGestureObservable","_initAudioContextAsync","async","_onAudioContextStateChange","_mainOut","createMainBusAsync","clearInterval","setInterval","_onUserGestureAsync","resume","audio","controls","preload","loop","src","play","_startUpdating","_update","callback","hasObservers","listenerAutoUpdate","audioContext","OfflineAudioContext","AudioContext","disableDefaultUI","defaultUIParentElement","_initAsync","resumeOnInteraction","resumeOnPause","resumeOnPauseRetryInterval","listenerEnabled","_HasSpatialAudioListenerOptions","destination","mainOut","_unmuteUIEnabled","createBusAsync","bus","import","_WebAudioBus","_WebAudioMainBus","createMicrophoneSoundSourceAsync","mediaStream","navigator","mediaDevices","getUserMedia","e","createSoundSourceAsync","MediaStreamAudioSourceNode","outBusAutoDefault","createSoundAsync","source","_WebAudioStaticSound","createSoundBufferAsync","soundBuffer","_WebAudioStaticSoundBuffer","soundSource","_WebAudioSoundSource","createStreamingSoundAsync","_WebAudioStreamingSound","close","removeEventListener","flagInvalidFormat","format","isFormatValid","mimeType","Audio","canPlayType","pauseAsync","suspend","_addUpdateObserver","_removeUpdateObserver","AbstractEngine","AudioEngineFactory","hostElement","audioDestination","AudioEngine","masterGain","_masterGain","_v2","useCustomUnlockedButton","_useCustomUnlockedButton","_triggerRunningStateAsync","_tryToRun","canUseWebAudio","WarnedWebAudioUnsupported","isMP3supported","isOGGsupported","unlocked","onAudioUnlockedObservable","onAudioLockedObservable","v2","then","mainBusOutNode","_outNode","lock","unlock","_resumeAudioContextOnStateChange","_resumeAudioContextAsync","once","passive","signal","AbortSignal","timeout","getGlobalVolume","setGlobalVolume","newVolume","connectToAnalyser","analyser","_connectedAnalyser","stopDebugCanvas","connectAudioNodes"],"mappings":"4FACO,IAAIA,GACX,SAAWA,GACPA,EAAcA,EAA0B,WAAI,GAAK,aACjDA,EAAcA,EAA2B,YAAI,GAAK,cAClDA,EAAcA,EAAsC,uBAAI,GAAK,wBAChE,CAJD,CAIGA,IAAkBA,EAAgB,CAAA,IAc9B,MAAMC,EACT,WAAAC,CAAYC,EAAQC,GAIhBC,KAAKC,oBAAsB,IAAIC,EAC/BF,KAAKF,OAASA,EACC,EAAXC,IACAC,KAAKG,eAAiB,IAAIC,KAEf,EAAXL,IACAC,KAAKK,iBAAmB,IAAID,IAExC,CAMI,OAAAE,GACI,GAAIN,KAAKK,iBAAkB,CACvB,IAAK,MAAME,KAAQC,MAAMC,KAAKT,KAAKK,kBAC/B,IAAKL,KAAKU,YAAYH,GAClB,MAAM,IAAII,MAAM,qBAGxBX,KAAKK,iBAAiBO,OAClC,CACQ,GAAIZ,KAAKG,eAAgB,CACrB,IAAK,MAAMI,KAAQC,MAAMC,KAAKT,KAAKG,gBAC/B,IAAKI,EAAKG,YAAYV,MAClB,MAAM,IAAIW,MAAM,qBAGxBX,KAAKG,eAAeS,OAChC,CACQZ,KAAKC,oBAAoBY,gBAAgBb,MACzCA,KAAKC,oBAAoBW,OACjC,CAMI,QAAAE,CAASP,GACL,QAAKP,KAAKK,oBAGNL,KAAKK,iBAAiBU,IAAIR,OAGzBA,EAAKS,WAAWhB,QAGrBA,KAAKK,iBAAiBY,IAAIV,IACnB,IACf,CAMI,WAAAG,CAAYH,GACR,QAAKP,KAAKK,qBAGLL,KAAKK,iBAAiBa,OAAOX,IAG3BA,EAAKY,cAAcnB,MAClC,CAMI,UAAAgB,CAAWT,GACP,QAAKP,KAAKG,kBAGNH,KAAKG,eAAeY,IAAIR,KAG5BP,KAAKG,eAAec,IAAIV,IACjB,GACf,CAMI,aAAAY,CAAcZ,GACV,OAAOP,KAAKG,gBAAgBe,OAAOX,KAAS,CACpD,EAKO,MAAMa,UAA+BxB,EACxC,WAAAC,CAAYwB,EAAMvB,EAAQC,GACtBuB,MAAMxB,EAAQC,GAIdC,KAAKuB,wBAA0B,IAAIrB,EACnCF,KAAKwB,MAAQH,CACrB,CAMI,QAAIA,GACA,OAAOrB,KAAKwB,KACpB,CACI,QAAIH,CAAKI,GACL,GAAIzB,KAAKwB,QAAUC,EACf,OAEJ,MAAMC,EAAU1B,KAAKwB,MACrBxB,KAAKwB,MAAQC,EACbzB,KAAKuB,wBAAwBV,gBAAgB,CAAEY,UAASC,UAASnB,KAAMP,MAC/E,CACI,OAAAM,GACIgB,MAAMhB,UACNN,KAAKuB,wBAAwBX,OACrC,EC5IO,MAAMe,EAET,WAAA9B,CAAY+B,GAER5B,KAAK6B,gBAAkB,EACvB7B,KAAK8B,UAAY,IAAIC,EACrB/B,KAAKgC,oBAAsB,IAAIC,EAC/BjC,KAAKkC,WAAa,KAClBlC,KAAKmC,iBAAkB,EAIvBnC,KAAKM,QAAU,KACXN,KAAKoC,UAETpC,KAAKqC,kBAAoBT,CACjC,CAII,cAAIU,GACA,OAA2B,OAApBtC,KAAKkC,UACpB,CAWI,MAAAK,CAAOC,EAAWC,EAAgBC,GAC1B1C,KAAKkC,aAAeM,IAGxBxC,KAAKoC,SACAI,IAGLxC,KAAK6B,gBAAkBa,EACvB1C,KAAKkC,WAAaM,EAClBxC,KAAKkC,WAAWjC,oBAAoBgB,IAAIjB,KAAKM,SAC7CN,KAAKmC,gBAAkBM,GAC/B,CAII,MAAAL,GACIpC,KAAKkC,YAAYjC,oBAAoB0C,eAAe3C,KAAKM,SACzDN,KAAKkC,WAAa,IAC1B,CAMI,MAAAU,GAC+B,EAAvB5C,KAAK6B,kBACD7B,KAAKmC,iBAAmBnC,KAAKkC,WAAWW,gBACxC7C,KAAK8B,UAAUgB,SAAS9C,KAAKkC,WAAWW,kBAAkBE,YAAYC,aAGtEhD,KAAKkC,YAAYe,iBAAiBC,oBAAoBlD,KAAK8B,WAE/D9B,KAAKqC,kBAAkBc,SAASL,SAAS9C,KAAK8B,WAC9C9B,KAAKqC,kBAAkBe,mBAEA,EAAvBpD,KAAK6B,kBACL7B,KAAKkC,YAAYe,iBAAiBI,eAAUC,EAAWtD,KAAKgC,qBAC5DhC,KAAKqC,kBAAkBkB,mBAAmBT,SAAS9C,KAAKgC,qBACxDhC,KAAKqC,kBAAkBmB,kBAEnC,EChFY,MAACC,EAAsB,IAAIC,OAAO,wBACxCC,EAAc,IACdC,EAAgB,IAAIC,aAAa,CAAC,EAAG,IAC3C,IAAIC,EAAiB,KACjBC,EAAW,KACXC,EAAW,KAgCR,SAASC,EAA0BC,EAAOzD,EAAM0D,GAInD,IAAIC,EACJ,GAJKN,IACDA,EAAiB,IAAID,aAAaF,IAGxB,WAAVO,EAGA,OAFAN,EAAc,GAAKnD,EACnBmD,EAAc,GAAKO,EACZP,EAEN,GAAc,gBAAVM,EACLE,EAvCR,WACI,IAAKL,EAAU,CACXA,EAAW,IAAIF,aAAaF,GAC5B,MAAMU,EAAY,KAClB,IAAIC,EAAID,EACR,IAAK,IAAIE,EAAI,EAAGA,EAAIZ,EAAaY,IAC7BR,EAASQ,GAAKC,KAAKC,yBAA2B,EAAIH,IAClDA,GAAKD,CAEjB,CACI,OAAON,CACX,CA4B0BW,OAEjB,IAAc,gBAAVR,EAIL,MAAM,IAAIvD,MAAM,uBAAuBuD,KAHvCE,EA3BR,WACI,IAAKJ,EAAU,CACXA,EAAW,IAAIH,aAAaF,GAC5B,MAAMU,EAAY,IAClB,IAAIC,EAAID,EACR,IAAK,IAAIE,EAAI,EAAGA,EAAIZ,EAAaY,IAC7BP,EAASO,GAAK,EAAIC,KAAKG,MAAML,GAAKE,KAAKG,MAAMhB,GAC7CW,GAAKD,CAEjB,CACI,OAAOL,CACX,CAgB0BY,EAI1B,CACI,MAAMC,EAAYL,KAAKM,KAAKX,EAAK1D,GAC3BsE,EAAQP,KAAKQ,IAAIb,EAAK1D,GAC5B,GAAkB,IAAdoE,EACA,IAAK,IAAIN,EAAI,EAAGA,EAAIH,EAAgBa,OAAQV,IACxCT,EAAeS,GAAK9D,EAAOsE,EAAQX,EAAgBG,OAGtD,CACD,IAAIW,EAAIvB,GACR,IAAK,IAAIY,EAAI,EAAGA,EAAIH,EAAgBa,OAAQV,IAAKW,IAC7CpB,EAAeS,GAAK9D,EAAOsE,GAAS,EAAIX,EAAgBc,GAEpE,CACI,OAAOpB,CACX,CAEO,SAASqB,EAAUC,GACtB,OAAOA,EAAIC,QAAQ,MAAO,MAC9B,CCjEO,MAAMC,EAET,WAAAzF,CAAYC,EAAQyF,GAChBvF,KAAKwF,aAAe,EACpBxF,KAAKyF,QAAU3F,EACfE,KAAK0F,OAASH,EACdvF,KAAK2F,aAAeJ,EAAMK,KAClC,CAEI,aAAIC,GACA,OAAO7F,KAAKyF,QAAQK,YAAc9F,KAAKwF,YAC/C,CAEI,eAAIO,GACA,OAAO/F,KAAK2F,YACpB,CACI,eAAII,CAAYH,GACZ5F,KAAKgG,eAAeJ,EAC5B,CAEI,SAAIA,GACA,OAAO5F,KAAK0F,OAAOE,KAC3B,CAEI,OAAAtF,GACIN,KAAK0F,OAAS,KACd1F,KAAKyF,QAAU,IACvB,CAMI,cAAAO,CAAeJ,EAAOK,EAAU,MAC5B,MAAM/B,EAAkC,iBAAnB+B,GAAS/B,MAAqB+B,EAAQ/B,MAAQ,SAC7DgC,EAAYlG,KAAKyF,QAAQK,YAC/B,GAAc,SAAV5B,EAIA,OAHAlE,KAAK0F,OAAOS,sBAAsB,GAClCnG,KAAK0F,OAAOE,MAAQ5F,KAAK2F,aAAeC,OACxC5F,KAAKwF,aAAeU,GAGxB,IAAIE,EAAwC,iBAAtBH,GAASG,SAAwB5B,KAAK6B,IAAIJ,EAAQG,SAAUpG,KAAKyF,QAAQa,uBAAyBtG,KAAKyF,QAAQa,uBAChIF,EAAW5B,KAAK6B,IAAIrG,KAAKyF,QAAQa,sBAAuBF,IA7C7C,KA8CZpG,KAAK0F,OAAOa,eAAgBvG,KAAK2F,aAAeC,EAAQM,IAG5DlG,KAAK0F,OAAOS,sBAAsB,GAClCnG,KAAK0F,OAAOc,oBAAoBvC,EAA0BC,EAAOlE,KAAK0F,OAAOE,MAAQ5F,KAAK2F,aAAeC,GAASM,EAAWE,GAC7HpG,KAAKwF,aAAeU,EAAYE,EACxC,ECzDO,MAAMK,EAET,WAAA5G,CAAY6G,EAAQC,EAAYC,GAK5B,GAJA5G,KAAK6G,aAAc,EACnB7G,KAAK8G,gBAAkB,EAEvB9G,KAAK4G,cAAgB,GAChBD,EACD,OAEJ3G,KAAK4G,cAAgBA,EACrB,MAAMhE,EAAS,KACX,IAAK5C,KAAK6G,YACN,OAEJ,IAAIE,GAAa,EACjB,GAAI,EAAI/G,KAAK4G,cAAe,CACxB,MAAMI,EAAMC,EAAcC,IACtBlH,KAAK8G,iBAAmBE,EAAMhH,KAAK8G,gBAAkB9G,KAAK4G,gBAC1DG,GAAa,GAEjB/G,KAAK8G,gBAAkBE,CACvC,CACiBD,GACDL,EAAO9D,SAEXuE,sBAAsBvE,IAE1BuE,sBAAsBvE,EAC9B,CAEI,OAAAtC,GACIN,KAAK6G,aAAc,CAC3B,ECnBO,MAAMO,EACT,WAAAvH,CAAYoG,GAERjG,KAAKqH,WAAa,IAAIjH,IACtBJ,KAAKsH,QAAU,IAAIlH,IACnBJ,KAAKuH,aAAe,KAEpBvH,KAAKwH,OAAS,IAAIpH,IAClBJ,KAAKyH,gBAAkB,KACvBzH,KAAK0H,uBAAyB,IAEe,iBAAlCzB,EAAQK,wBACftG,KAAKsG,sBAAwBL,EAAQK,sBAEjD,CAMI,kBAAIqB,GACA,OAA6B,IAAzB3H,KAAKqH,WAAWO,KACT,MAEN5H,KAAKyH,kBACNzH,KAAKyH,gBAAkBjH,MAAMC,KAAKT,KAAKqH,YAAY,IAEhDrH,KAAKyH,gBACpB,CAII,yBAAInB,GACA,OAAOtG,KAAK0H,sBACpB,CACI,yBAAIpB,CAAsBV,GACtB5F,KAAK0H,uBAAyBlD,KAAK6B,IAAI,EAAGT,EAClD,CAII,UAAIiC,GAIA,OAHK7H,KAAKuH,eACNvH,KAAKuH,aAAe/G,MAAMC,KAAKT,KAAKsH,UAEjCtH,KAAKuH,YACpB,CAII,OAAAjH,GAII,MAAMwH,EAAS9H,KAAKwH,OAAOO,SAC3B,IAAK,IAAIC,EAAOF,EAAOE,QAASA,EAAKC,KAAMD,EAAOF,EAAOE,OACrDA,EAAKpC,MAAMtF,UAEfN,KAAKqH,WAAWzG,QAChBZ,KAAKwH,OAAO5G,QACZZ,KAAKsH,QAAQ1G,QACbZ,KAAKkI,sBACLlI,KAAKyH,gBAAkB,IAC/B,CAOI,WAAAU,GACI,OAAOnI,KAAKoI,aACpB,CACI,WAAAC,CAAYC,GACRtI,KAAKqH,WAAWpG,IAAIqH,GACpBtI,KAAKuI,SAASD,EACtB,CACI,cAAAE,CAAeF,GACXtI,KAAKqH,WAAWnG,OAAOoH,GACvBtI,KAAKyH,gBAAkB,KACvBzH,KAAKyI,YAAYH,EACzB,CACI,QAAAC,CAAShI,GACLP,KAAKwH,OAAOvG,IAAIV,EACxB,CACI,WAAAkI,CAAYlI,GACRP,KAAKwH,OAAOtG,OAAOX,EAC3B,CACI,SAAAmI,CAAUC,GACN3I,KAAKkI,sBACLlI,KAAKsH,QAAQrG,IAAI0H,GACjB3I,KAAKuI,SAASI,EACtB,CACI,YAAAC,CAAaD,GACT3I,KAAKkI,sBACLlI,KAAKsH,QAAQpG,OAAOyH,GACpB3I,KAAKyI,YAAYE,EACzB,CACI,mBAAAT,GACQlI,KAAKuH,eACLvH,KAAKuH,aAAatC,OAAS,EAC3BjF,KAAKuH,aAAe,KAEhC,ECtHO,MAAMsB,EAAgC,CACzC1F,SAAUpB,EAAQ+G,OAClBC,SAAUhH,EAAQ+G,OAClBvF,mBAAoB,IAAItB,GAkBrB,MAAM+G,GCnBN,MAAMC,UAA8BD,EACvC,WAAAnJ,GACIyB,QACAtB,KAAKkJ,mBAAqB,KAC1BlJ,KAAKkJ,mBAAqB,IAAIvH,EAA+B3B,KACrE,CAEI,cAAIsC,GACA,OAAmC,OAA5BtC,KAAKkJ,oBAA+BlJ,KAAKkJ,mBAAmB5G,UAC3E,CAWI,MAAAC,CAAOC,EAAWC,GAAiB,EAAOC,EAAiB,GAClD1C,KAAKkJ,qBACNlJ,KAAKkJ,mBAAqB,IAAIvH,EAA+B3B,OAEjEA,KAAKkJ,mBAAmB3G,OAAOC,EAAWC,EAAgBC,EAClE,CAII,MAAAN,GACIpC,KAAKkJ,oBAAoB9G,QACjC,CAEI,OAAA9B,GACIN,KAAKkJ,oBAAoB5I,UACzBN,KAAKkJ,mBAAqB,IAClC,CAEI,UAAAC,CAAWlD,QAC+B3C,IAAlC2C,EAAQmD,wBACRpJ,KAAK4G,cAAgBX,EAAQmD,uBAE7BnD,EAAQoD,mBACRrJ,KAAKmD,SAAW8C,EAAQoD,iBAAiBC,SAEzCrD,EAAQsD,2BACRvJ,KAAKuD,mBAAqB0C,EAAQsD,2BAA2BD,QAExDrD,EAAQuD,iBACbxJ,KAAK+I,SAAW9C,EAAQuD,iBAAiBF,QAGzCtJ,KAAKuD,mBAAqBsF,EAA8BtF,mBAAmB+F,QAE/EtJ,KAAK4C,QACb,ECtDA,MAAM6G,EAAYC,EAAOZ,OACnBa,EAAgB,IAAI1H,EACpB2H,EAAa7H,EAAQ+G,OACrBe,EAAa9H,EAAQ+G,OAEpB,SAASgB,EAA4BhK,EAAQ6G,EAAYC,GAC5D,MAAMmD,EAAWjK,EAAOkK,cAAcD,SACtC,OAAIA,EAASE,UACTF,EAASG,UACTH,EAASI,UACTJ,EAASK,WACTL,EAASM,WACTN,EAASO,WACTP,EAASQ,KACTR,EAASS,KACTT,EAASU,IACF,IAAIC,EAAyB5K,EAAQ6G,EAAYC,GAGjD,IAAI+D,EAAiC7K,EAAQ6G,EAAYC,EAExE,CACA,MAAMgE,UAAyC3B,EAE3C,WAAApJ,CAAYC,EAAQ6G,EAAYC,GAC5BtF,QACAtB,KAAK6K,cAAgB9I,EAAQ+G,OAC7B9I,KAAK8K,cAAgB/I,EAAQ+G,OAC7B9I,KAAK+K,wBAA0B,IAAI9I,EAEnCjC,KAAKmD,SAAWpB,EAAQ+G,OAExB9I,KAAK+I,SAAWhH,EAAQ+G,OAExB9I,KAAKuD,mBAAqB,IAAItB,EAC9BjC,KAAKgL,UAAYlL,EAAOkK,cAAcD,SACtC/J,KAAKF,OAASA,EACdE,KAAKiL,kBAAoB,IAAIxE,EAAiCzG,KAAM2G,EAAYC,EACxF,CAEI,OAAAtG,GACIgB,MAAMhB,UACNN,KAAKiL,kBAAkB3K,UACvBN,KAAKiL,kBAAoB,IACjC,CAEI,iBAAIrE,GACA,OAAO5G,KAAKiL,kBAAkBrE,aACtC,CAEI,iBAAIA,CAAchB,GACd5F,KAAKiL,kBAAkBrE,cAAgBhB,CAC/C,CAEI,MAAAhD,GACQ5C,KAAKsC,WACLtC,KAAKkJ,oBAAoBtG,UAGzB5C,KAAKoD,kBACLpD,KAAKwD,kBAEjB,CACI,eAAAJ,GACQpD,KAAK6K,cAAcK,kBAAkBlL,KAAKmD,YAG9CnD,KAAKmL,qBAAqBnL,KAAKmD,UAC/BnD,KAAK6K,cAAc/H,SAAS9C,KAAKmD,UACzC,CACI,eAAAK,GACI,GAAKxD,KAAK+K,wBAAwBG,kBAAkBlL,KAAKuD,oBAIpD,IAAKvD,KAAK8K,cAAcI,kBAAkBlL,KAAK+I,UAKhD,OAJA9G,EAAWmJ,qBAAqBpL,KAAK+I,SAASzE,EAAGtE,KAAK+I,SAASsC,EAAGrL,KAAK+I,SAASuC,EAAG3B,GACnF3J,KAAK8K,cAAchI,SAAS9C,KAAK+I,SAI7C,MATYY,EAAc7G,SAAS9C,KAAKuD,oBAC5BvD,KAAK+K,wBAAwBjI,SAAS9C,KAAKuD,oBAS/CmG,EAAO6B,oBAAoB5B,EAAeF,GAE1C1H,EAAQyJ,qBAAqBzJ,EAAQ0J,2BAA4BhC,EAAWG,GAC5E7H,EAAQyJ,qBAAqBzJ,EAAQ2J,KAAMjC,EAAWI,GACtD7J,KAAK2L,wBAAwB/B,EAAYC,EACjD,EAeA,MAAMa,UAAiCE,EACnC,WAAA/K,CAAYC,EAAQ6G,EAAYC,GAC5BtF,MAAMxB,EAAQ6G,EAAYC,GAC1B,MAAMmD,EAAWjK,EAAOkK,cAAcD,SACtC/J,KAAK4L,UAAY,IAAItG,EAA4BxF,EAAQiK,EAASE,UAClEjK,KAAK6L,UAAY,IAAIvG,EAA4BxF,EAAQiK,EAASG,UAClElK,KAAK8L,UAAY,IAAIxG,EAA4BxF,EAAQiK,EAASI,UAClEnK,KAAK+L,WAAa,IAAIzG,EAA4BxF,EAAQiK,EAASK,WACnEpK,KAAKgM,WAAa,IAAI1G,EAA4BxF,EAAQiK,EAASM,WACnErK,KAAKiM,WAAa,IAAI3G,EAA4BxF,EAAQiK,EAASO,WACnEtK,KAAKkM,KAAO,IAAI5G,EAA4BxF,EAAQiK,EAASQ,KAC7DvK,KAAKmM,KAAO,IAAI7G,EAA4BxF,EAAQiK,EAASS,KAC7DxK,KAAKoM,KAAO,IAAI9G,EAA4BxF,EAAQiK,EAASU,IACrE,CACI,oBAAAU,CAAqBhI,GAGbnD,KAAKsC,aAAetC,KAAK+L,WAAWlG,WAAa7F,KAAKgM,WAAWnG,WAAa7F,KAAKiM,WAAWpG,aAGlG7F,KAAK+L,WAAWhG,YAAc5C,EAASmB,EACvCtE,KAAKgM,WAAWjG,YAAc5C,EAASkI,EACvCrL,KAAKiM,WAAWlG,YAAc5C,EAASmI,EAC/C,CACI,uBAAAK,CAAwBU,EAASC,GAGzBtM,KAAKsC,aACJtC,KAAK4L,UAAU/F,WAAa7F,KAAK6L,UAAUhG,WAAa7F,KAAK8L,UAAUjG,WAAa7F,KAAKkM,KAAKrG,WAAa7F,KAAKmM,KAAKtG,WAAa7F,KAAKoM,KAAKvG,aAGjJ7F,KAAK4L,UAAU7F,YAAcsG,EAAQ/H,EACrCtE,KAAK6L,UAAU9F,YAAcsG,EAAQhB,EACrCrL,KAAK8L,UAAU/F,YAAcsG,EAAQf,EACrCtL,KAAKkM,KAAKnG,YAAcuG,EAAGhI,EAC3BtE,KAAKmM,KAAKpG,YAAcuG,EAAGjB,EAC3BrL,KAAKoM,KAAKrG,YAAcuG,EAAGhB,EACnC,EAeA,MAAMX,UAAyCC,EAC3C,oBAAAO,CAAqBhI,GACjBnD,KAAKgL,UAAUuB,YAAYpJ,EAASmB,EAAGnB,EAASkI,EAAGlI,EAASmI,EACpE,CACI,uBAAAK,CAAwBU,EAASC,GAC7BtM,KAAKgL,UAAUwB,eAAeH,EAAQ/H,EAAG+H,EAAQhB,EAAGgB,EAAQf,EAAGgB,EAAGhI,EAAGgI,EAAGjB,EAAGiB,EAAGhB,EACtF,EC3JO,MAAMmB,UAAsB7M,EAC/B,WAAAC,CAAYC,GACRwB,MAAMxB,EAAQ,EACtB,ECTO,MAAM4M,UAAyBD,EAElC,WAAA5M,CAAYC,GACRwB,MAAMxB,GACNE,KAAK2M,aAAa,IAAIC,SAAS9M,EAAOkK,eAC9C,CAEI,OAAA1J,GACIgB,MAAMhB,UACNN,KAAK6M,QAAQvM,UACbN,KAAK8M,UAAUC,aACf/M,KAAKgN,iBAAiBD,YAC9B,CAEI,WAAIE,GACA,OAAOjN,KAAK8M,SACpB,CACI,WAAIG,CAAQrH,GACJ5F,KAAK8M,YAAclH,GAGvB5F,KAAK2M,aAAa/G,EAC1B,CAEI,UAAIsH,GACA,OAAOlN,KAAK6M,QAAQ9G,WAC5B,CAEI,UAAImH,CAAOtH,GACP5F,KAAK6M,QAAQ9G,YAAcH,CACnC,CACI,oBAAIoH,GACA,OAAOhN,KAAKF,OAAOqN,iBAC3B,CAEI,YAAAC,GACI,MAAO,kBACf,CAEI,SAAAC,CAAUzH,EAAOK,EAAU,MACvBjG,KAAK6M,QAAQ7G,eAAeJ,EAAOK,EAC3C,CACI,YAAA0G,CAAaW,GACLtN,KAAK8M,YAAcQ,IAGvBtN,KAAK8M,WAAWC,aAChBO,EAASC,QAAQvN,KAAKgN,kBACtBhN,KAAK6M,QAAU,IAAIvH,EAA4BtF,KAAKF,OAAQwN,EAASE,MACrExN,KAAK8M,UAAYQ,EACzB,EChDO,MAAMG,EAET,WAAA5N,CAAYC,EAAQ4N,GAChB1N,KAAK2N,QAAU,KACf3N,KAAK4N,UAAW,EAChB5N,KAAK6N,OAAS,KACd7N,KAAK8N,gBAAkB,KACd9N,KAAK2N,UAGiB,YAAvB3N,KAAKyF,QAAQsI,MACb/N,KAAKgO,QAGLhO,KAAKiO,UAGbjO,KAAKyF,QAAU3F,EACf,MAAM4G,EAASgH,GAAiBQ,EAAYC,mBAAmBC,mBAAmBV,eAAiBW,SAASC,KACtGC,GAAO7H,GAAQ8H,WAAa,GAAK,GACvCxO,KAAK6N,OAASQ,SAASI,cAAc,SACrCzO,KAAK6N,OAAOa,YAAYL,SAASM,eAAe,wCAAwCJ,28BACxFF,SAASO,KAAKF,YAAY1O,KAAK6N,QAC/B7N,KAAK2N,QAAUU,SAASI,cAAc,UACtCzO,KAAK2N,QAAQkB,UAAY,gBACzB7O,KAAK2N,QAAQmB,GAAK,sBAClB9O,KAAK2N,QAAQoB,iBAAiB,SAAS,KAEnC/O,KAAKyF,QAAQ0C,iBAEjBzB,EAAOgI,YAAY1O,KAAK2N,SACxB3N,KAAKyF,QAAQuJ,uBAAuB/N,IAAIjB,KAAK8N,gBACrD,CAEI,OAAAxN,GACIN,KAAK2N,SAASsB,SACdjP,KAAK2N,QAAU,KACf3N,KAAK6N,QAAQoB,SACbjP,KAAK6N,OAAS,KACd7N,KAAKyF,QAAQuJ,uBAAuBrM,eAAe3C,KAAK8N,gBAChE,CAEI,WAAIoB,GACA,OAAOlP,KAAK4N,QACpB,CACI,WAAIsB,CAAQtJ,GACR5F,KAAK4N,SAAWhI,EACZA,EAC2B,YAAvB5F,KAAKyF,QAAQsI,OACb/N,KAAKiO,QAITjO,KAAKgO,OAEjB,CACI,KAAAC,GACSjO,KAAK2N,SAAY3N,KAAK4N,WAG3B5N,KAAK2N,QAAQwB,MAAMC,QAAU,QACrC,CACI,KAAApB,GACShO,KAAK2N,UAGV3N,KAAK2N,QAAQwB,MAAMC,QAAU,OACrC,ECxDA,MAAMC,EAAkB,CACpBC,IAAK,YACLC,IAAK,YACLC,KAAM,aACNC,IAAK,YACLC,IAAK,2BACLC,IAAK,YACLC,IAAK,6BACLC,IAAK,YACLC,KAAM,+BAGH,MAAMC,UAAwB3I,EAEjC,WAAAvH,CAAYoG,EAAU,IAClB3E,MAAM2E,GACNjG,KAAKgQ,sBAAuB,EAC5BhQ,KAAKgN,iBAAmB,KACxBhN,KAAKiQ,gBAAkB,IAAI7P,IAC3BJ,KAAKkQ,aAAc,EACnBlQ,KAAKgL,UAAY,KACjBhL,KAAKmQ,qBAAsB,EAC3BnQ,KAAKoQ,uBAAyB,EAC9BpQ,KAAKqQ,cAAe,EACpBrQ,KAAKsQ,sBAAuB,EAC5BtQ,KAAKuQ,gBAAiB,EACtBvQ,KAAKwQ,4BAA8B,IACnCxQ,KAAKyQ,sBAAwB,KAC7BzQ,KAAK0Q,eAAiB,KACtB1Q,KAAK2Q,iBAAmB,KACxB3Q,KAAK4Q,UAAY,KACjB5Q,KAAK6Q,kBAAoB,KACzB7Q,KAAK8Q,cAAgB,IAAI1Q,IACzBJ,KAAK6M,QAAU,EAEf7M,KAAK+Q,6BAA8B,EAEnC/Q,KAAKgR,eAAiB,IAAIC,SAASC,IAC/BlR,KAAKmR,uBAAyBD,KAGlClR,KAAKgP,uBAAyB,IAAI9O,EAElCF,KAAKoR,sBAAwB,IAAIlR,EACjCF,KAAKqR,uBAAyBC,UAC1BtR,KAAKgK,cAAc+E,iBAAiB,cAAe/O,KAAKuR,4BACxDvR,KAAKwR,SAAW,IAAI9E,EAAiB1M,MACrCA,KAAKwR,SAAStE,OAASlN,KAAK6M,cACtB7M,KAAKyR,mBAAmB,YAElCzR,KAAKuR,2BAA6B,KACX,YAAfvR,KAAK+N,QACL2D,cAAc1R,KAAKyQ,uBACnBzQ,KAAKgQ,sBAAuB,EAC5BhQ,KAAK0Q,eAAiB,MAEP,cAAf1Q,KAAK+N,OAAwC,gBAAf/N,KAAK+N,OAC/B/N,KAAKgQ,sBAAwBhQ,KAAKuQ,iBAAmBvQ,KAAKqQ,eAC1DqB,cAAc1R,KAAKyQ,uBACnBzQ,KAAKyQ,sBAAwBkB,aAAY,KAErC3R,KAAKoI,gBACNpI,KAAKwQ,8BAGhBxQ,KAAKgP,uBAAuBnO,gBAAgBb,KAAK+N,QAErD/N,KAAK4R,oBAAsBN,UAMvB,GALItR,KAAKsQ,4BACCtQ,KAAKgK,cAAc6H,UAIxB7R,KAAK2Q,iBAAkB,CACxB3Q,KAAK2Q,iBAAmBtC,SAASI,cAAc,SAC/C,MAAMqD,EAAQ9R,KAAK2Q,iBACnBmB,EAAMC,UAAW,EACjBD,EAAME,QAAU,OAChBF,EAAMG,MAAO,EAEbH,EAAMI,IAAM,qGAEZJ,EAAMK,MACtB,CACYnS,KAAKoR,sBAAsBvQ,mBAE/Bb,KAAKoS,eAAiB,KAClB,IAAIpS,KAAKkQ,YAIT,GADAlQ,KAAKkQ,aAAc,EACA,YAAflQ,KAAK+N,MACL/N,KAAKqS,cAEJ,CACD,MAAMC,EAAW,KACM,YAAftS,KAAK+N,QACL/N,KAAKqS,UACLrS,KAAKgP,uBAAuBrM,eAAe2P,KAGnDtS,KAAKgP,uBAAuB/N,IAAIqR,EAChD,GAEQtS,KAAKqS,QAAU,KACPrS,KAAK6Q,mBAAmB0B,gBACxBvS,KAAK6Q,kBAAkBhQ,kBACvBsG,sBAAsBnH,KAAKqS,UAG3BrS,KAAKkQ,aAAc,GAGe,kBAA/BjK,EAAQuM,qBACfxS,KAAKmQ,oBAAsBlK,EAAQuM,oBAEM,iBAAlCvM,EAAQmD,wBACfpJ,KAAKoQ,uBAAyBnK,EAAQmD,uBAE1CpJ,KAAK6M,QAAU5G,EAAQiH,QAAU,EAC7BjH,EAAQwM,cACRzS,KAAK+Q,4BAA8B9K,EAAQwM,wBAAwBC,oBACnE1S,KAAKgK,cAAgB/D,EAAQwM,cAG7BzS,KAAKgK,cAAgB,IAAI2I,aAExB1M,EAAQ2M,mBACT5S,KAAK4Q,UAAY,IAAInD,EAAkBzN,KAAMiG,EAAQ4M,wBAEjE,CAEI,gBAAMC,CAAW7M,GACbjG,KAAKsQ,qBAA8D,kBAAhCrK,EAAQ8M,qBAAoC9M,EAAQ8M,oBACvF/S,KAAKuQ,eAAkD,kBAA1BtK,EAAQ+M,eAA8B/M,EAAQ+M,cAC3EhT,KAAKwQ,4BAA8BvK,EAAQgN,4BAA8B,IACzE5E,SAASU,iBAAiB,QAAS/O,KAAK4R,2BAClC5R,KAAKqR,yBN/IZ,SAAyCpL,GAC5C,OAAQA,EAAQiN,sBACsB5P,IAAlC2C,EAAQmD,4BACqB9F,IAA7B2C,EAAQoD,uBACqB/F,IAA7B2C,EAAQuD,uBAC+BlG,IAAvC2C,EAAQsD,0BAChB,CM0IY4J,CAAgClN,KAChCjG,KAAKgL,UAAYlB,EAA4B9J,KAAMA,KAAKmQ,oBAAqBnQ,KAAKoQ,wBAClFpQ,KAAKgL,UAAU7B,WAAWlD,IAE9BjG,KAAKmR,wBACb,CAEI,eAAIrL,GACA,OAAO9F,KAAKgK,cAAclE,aAAe,CACjD,CAEI,WAAImH,GACA,OAAOjN,KAAKgK,cAAcoJ,WAClC,CAEI,WAAIC,GACA,OAAOrT,KAAKwR,QACpB,CAEI,YAAIzH,GACA,OAAO/J,KAAKgL,YAAchL,KAAKgL,UAAYlB,EAA4B9J,KAAMA,KAAKmQ,oBAAqBnQ,KAAKoQ,wBACpH,CAEI,SAAIrC,GAEA,OAAO/N,KAAK+Q,4BAA8B,UAAY/Q,KAAKgK,cAAc+D,KACjF,CAEI,UAAIb,GACA,OAAOlN,KAAK6M,OACpB,CAEI,UAAIK,CAAOtH,GACH5F,KAAK6M,UAAYjH,IAGrB5F,KAAK6M,QAAUjH,EACX5F,KAAKwR,WACLxR,KAAKwR,SAAStE,OAAStH,GAEnC,CAKI,qBAAIuH,GACA,OAAOnN,KAAKgN,iBAAmBhN,KAAKgN,iBAAoBhN,KAAKgN,iBAAmBhN,KAAKgK,cAAcoJ,WAC3G,CACI,qBAAIjG,CAAkBvH,GAClB5F,KAAKgN,iBAAmBpH,CAChC,CAKI,oBAAI0N,GACA,QAAOtT,KAAK4Q,WAAY5Q,KAAK4Q,UAAU1B,OAC/C,CACI,oBAAIoE,CAAiB1N,GACb5F,KAAK4Q,YACL5Q,KAAK4Q,UAAU1B,QAAUtJ,EAErC,CAEI,oBAAM2N,CAAelS,EAAM4E,EAAU,IACjC,MACMuN,EAAM,WADSC,OAAO,sCACLC,cAAarS,EAAMrB,KAAMiG,GAEhD,aADMuN,EAAIV,WAAW7M,GACduN,CACf,CAEI,wBAAM/B,CAAmBpQ,EAAM4E,EAAU,IACrC,MACMuN,EAAM,WADSC,OAAO,0CACLE,kBAAiBtS,EAAMrB,MAE9C,aADMwT,EAAIV,WAAW7M,GACduN,CACf,CAEI,sCAAMI,CAAiCvS,EAAM4E,GACzC,IAAI4N,EACJ,IACIA,QAAoBC,UAAUC,aAAaC,aAAa,CAAElC,OAAO,GAC7E,CACQ,MAAOmC,GACH,MAAM,IAAItT,MAAM,gCAAkCsT,EAC9D,CACQ,aAAajU,KAAKkU,uBAAuB7S,EAAM,IAAI8S,2BAA2BnU,KAAKgK,cAAe,CAAE6J,gBAAgB,CAChHO,mBAAmB,KAChBnO,GAEf,CAEI,sBAAMoO,CAAiBhT,EAAMiT,EAAQrO,EAAU,CAAA,GAC3C,MACM0C,EAAQ,WADO8K,OAAO,8CACHc,sBAAqBlT,EAAMrB,KAAMiG,GAE1D,aADM0C,EAAMmK,WAAWwB,EAAQrO,GACxB0C,CACf,CAEI,4BAAM6L,CAAuBF,EAAQrO,EAAU,IAC3C,MACMwO,EAAc,WADChB,OAAO,8CACGiB,4BAA2B1U,MAE1D,aADMyU,EAAY3B,WAAWwB,EAAQrO,GAC9BwO,CACf,CAEI,4BAAMP,CAAuB7S,EAAMiT,EAAQrO,EAAU,CAAA,GACjD,MACM0O,EAAc,WADClB,OAAO,8CACGmB,sBAAqBvT,EAAMiT,EAAQtU,KAAMiG,GAExE,aADM0O,EAAY7B,WAAW7M,GACtB0O,CACf,CAEI,+BAAME,CAA0BxT,EAAMiT,EAAQrO,EAAU,CAAA,GACpD,MACM0C,EAAQ,WADO8K,OAAO,iDACHqB,yBAAwBzT,EAAMrB,KAAMiG,GAE7D,aADM0C,EAAMmK,WAAWwB,EAAQrO,GACxB0C,CACf,CAEI,OAAArI,GACIgB,MAAMhB,UACNN,KAAKgL,WAAW1K,UAChBN,KAAKgL,UAAY,KAEgB,WAA7BhL,KAAKgK,cAAc+D,OAAuB/N,KAAK+Q,6BAE/C/Q,KAAKgK,cAAc+K,QAEvB1G,SAAS2G,oBAAoB,QAAShV,KAAK4R,qBAC3C5R,KAAKgK,cAAcgL,oBAAoB,cAAehV,KAAKuR,4BAC3DvR,KAAK2Q,kBAAkB1B,SACvBjP,KAAK6Q,mBAAmBjQ,QACxBZ,KAAK6Q,kBAAoB,KACzB7Q,KAAK4Q,WAAWtQ,UAChBN,KAAK4Q,UAAY,KACjB5Q,KAAKgP,uBAAuBpO,OACpC,CAEI,iBAAAqU,CAAkBC,GACdlV,KAAKiQ,gBAAgBhP,IAAIiU,EACjC,CAEI,aAAAC,CAAcD,GACV,GAAIlV,KAAK8Q,cAAc/P,IAAImU,GACvB,OAAO,EAEX,GAAIlV,KAAKiQ,gBAAgBlP,IAAImU,GACzB,OAAO,EAEX,MAAME,EAAW/F,EAAgB6F,GACjC,QAAiB5R,IAAb8R,EACA,OAAO,EAGX,MAAoC,MADtB,IAAIC,OACRC,YAAYF,IAClBpV,KAAKiQ,gBAAgBhP,IAAIiU,IAClB,IAEXlV,KAAK8Q,cAAc7P,IAAIiU,IAChB,EACf,CAEI,gBAAMK,SACIvV,KAAKgK,cAAcwL,UACzBxV,KAAKqQ,cAAe,CAC5B,CAGI,WAAAjI,GAEI,OADApI,KAAKqQ,cAAe,EAChBrQ,KAAK0Q,iBAGT1Q,KAAK0Q,eAAiB1Q,KAAKgK,cAAc6H,SACzC7R,KAAKgP,uBAAuBnO,gBAAgBb,KAAK+N,QAHtC/N,KAAK0Q,cAKxB,CAEI,SAAArD,CAAUzH,EAAOK,EAAU,MACvB,IAAIjG,KAAKwR,SAIL,MAAM,IAAI7Q,MAAM,oCAHhBX,KAAKwR,SAASnE,UAAUzH,EAAOK,EAK3C,CAEI,WAAAoC,CAAYC,GACRhH,MAAM+G,YAAYC,EAC1B,CAEI,cAAAE,CAAeF,GACXhH,MAAMkH,eAAeF,EAC7B,CAEI,QAAAC,CAAShI,GACLe,MAAMiH,SAAShI,EACvB,CAEI,WAAAkI,CAAYlI,GACRe,MAAMmH,YAAYlI,EAC1B,CAEI,SAAAmI,CAAUC,GACNrH,MAAMoH,UAAUC,EACxB,CAEI,YAAAC,CAAaD,GACTrH,MAAMsH,aAAaD,EAC3B,CAEI,kBAAA8M,CAAmBnD,GACVtS,KAAK6Q,oBACN7Q,KAAK6Q,kBAAoB,IAAI3Q,GAEjCF,KAAK6Q,kBAAkB5P,IAAIqR,GAC3BtS,KAAKoS,gBACb,CACI,qBAAAsD,CAAsBpD,GACdtS,KAAK6Q,mBACL7Q,KAAK6Q,kBAAkBlO,eAAe2P,EAElD,ECrXAqD,EAAeC,mBAAqB,CAACC,EAAapD,EAAcqD,IACrD,IAAIC,EAAYF,EAAapD,EAAcqD,GAO/C,MAAMC,EAIT,cAAIC,GACA,OAAOhW,KAAKiW,WACpB,CACI,cAAID,CAAWpQ,GACX5F,KAAKiW,YAAcjW,KAAKkW,IAAI7C,QAAQpG,QAAUrH,CACtD,CAKI,2BAAIuQ,GACA,OAAOnW,KAAKoW,wBACpB,CACI,2BAAID,CAAwBvQ,GACxB5F,KAAKoW,yBAA2BxQ,EAChC5F,KAAKkW,IAAI5C,kBAAoB1N,CACrC,CAII,gBAAI6M,GAMA,MALuB,YAAnBzS,KAAKkW,IAAInI,OAGT/N,KAAKqW,4BAEFrW,KAAKkW,IAAIlM,aACxB,CAQI,WAAAnK,CAAYgW,EAAc,KAAMpD,EAAe,KAAMqD,EAAmB,MACpE9V,KAAKsW,WAAY,EACjBtW,KAAKoW,0BAA2B,EAIhCpW,KAAKuW,gBAAiB,EAKtBvW,KAAKwW,2BAA4B,EAIjCxW,KAAKyW,gBAAiB,EAItBzW,KAAK0W,gBAAiB,EAMtB1W,KAAK2W,UAAW,EAIhB3W,KAAK4W,0BAA4B,IAAI1W,EAIrCF,KAAK6W,wBAA0B,IAAI3W,EACnC,MAAM4W,EAAK,IAAI/G,EAAgB,CAC3B0C,aAAcA,QAA8BnP,EAC5CuP,uBAAwBgD,GAAanI,cAAgBmI,EAAYnI,mBAAgBpK,IAIrFwT,EAAGxD,kBAAmB,EACtBtT,KAAKiW,YAAc,IAAIrJ,SAASkK,EAAG9M,eACnC8M,EAAG3J,kBAAoB2I,EACvBgB,EAAG9H,uBAAuB/N,KAAK8M,IACb,YAAVA,GACA/N,KAAK2W,UAAW,EAChB3W,KAAK4W,0BAA0B/V,gBAAgBb,QAG/CA,KAAK2W,UAAW,EAChB3W,KAAK6W,wBAAwBhW,gBAAgBb,UAIrD8W,EAAGhE,WAAW,CAAEC,qBAAqB,IAASgE,MAAK,KAC/C,MAAMC,EAAiBF,EAAGnP,eAAesP,SACrCD,IACAA,EAAejK,WAAW+J,EAAGzD,QAAQpG,SACrC+J,EAAezJ,QAAQvN,KAAKiW,cAEhCa,EAAGzD,QAAQpG,QAAUjN,KAAKiW,YAC1Ba,EAAG9H,uBAAuBnO,gBAAgBiW,EAAG/I,UAEjD/N,KAAKyW,eAAiBK,EAAG3B,cAAc,OACvCnV,KAAK0W,eAAiBI,EAAG3B,cAAc,OACvCnV,KAAKkW,IAAMY,CACnB,CAKI,IAAAI,GAEIlX,KAAKkW,IAAIlM,cAAcwL,UAClBxV,KAAKoW,2BACNpW,KAAKkW,IAAI5C,kBAAmB,EAExC,CAKI,MAAA6D,GAC0C,YAAlCnX,KAAKkW,IAAIlM,eAAe+D,MAS5B/N,KAAKqW,4BARIrW,KAAK2W,WAEN3W,KAAK2W,UAAW,EAChB3W,KAAK4W,0BAA0B/V,gBAAgBb,MAM/D,CAEI,gCAAAoX,GACIpX,KAAKkW,IAAIlM,eAAe+E,iBAAiB,eAAe,KAChD/O,KAAK2W,UAA8C,YAAlC3W,KAAKkW,IAAIlM,eAAe+D,OAEzC/N,KAAKqX,6BAEV,CACCC,MAAM,EACNC,SAAS,EACTC,OAAQC,YAAYC,QAAQ,MAExC,CAEI,wBAAAL,GACI,OAAIrX,KAAKkW,IAAInF,4BACFE,QAAQC,WAEkB,cAAjClR,KAAKkW,IAAIlM,cAAc+D,OAA0B/N,KAAKoW,2BACtDpW,KAAKkW,IAAI5C,kBAAmB,GAEzBtT,KAAKkW,IAAIlM,cAAc6H,SACtC,CAII,OAAAvR,GACIN,KAAKkW,IAAI5V,UACTN,KAAK4W,0BAA0BhW,QAC/BZ,KAAK6W,wBAAwBjW,OACrC,CAKI,eAAA+W,GACI,OAAO3X,KAAKgW,WAAWxI,KAAK5H,KACpC,CAKI,eAAAgS,CAAgBC,GACZ7X,KAAKgW,WAAWxI,KAAK5H,MAAQiS,CACrC,CAOI,iBAAAC,CAAkBC,GACV/X,KAAKgY,oBACLhY,KAAKgY,mBAAmBC,kBAE5BjY,KAAKgY,mBAAqBD,EAC1B/X,KAAKgW,WAAWjJ,aAChB/M,KAAKgY,mBAAmBE,kBAAkBlY,KAAKgW,WAAYhW,KAAKkW,IAAIlM,cAAcoJ,YAC1F,CACI,+BAAMiD,GACErW,KAAKsW,UACAtW,KAAKkW,IAAIlM,cAAc6H,UAGhC7R,KAAKsW,WAAY,QACXtW,KAAKqX,2BACXrX,KAAKsW,WAAY,EACjBtW,KAAK2W,UAAW,EAChB3W,KAAK4W,0BAA0B/V,gBAAgBb,MACvD"}