{"version":3,"file":"flowGraphStopAnimationBlock-CGv1RFTh.esm.js","sources":["../../../../../dev/core/dist/FlowGraph/Blocks/Execution/Animation/flowGraphStopAnimationBlock.js"],"sourcesContent":["import { RichTypeAny, RichTypeNumber } from \"../../../flowGraphRichTypes\";\nimport { RegisterClass } from \"../../../../Misc/typeStore\";\nimport { Logger } from \"core/Misc/logger\";\nimport { FlowGraphAsyncExecutionBlock } from \"core/FlowGraph/flowGraphAsyncExecutionBlock\";\n/**\n * @experimental\n * Block that stops a running animation\n */\nexport class FlowGraphStopAnimationBlock extends FlowGraphAsyncExecutionBlock {\n    constructor(config) {\n        super(config);\n        this.animationGroup = this.registerDataInput(\"animationGroup\", RichTypeAny);\n        this.stopAtFrame = this.registerDataInput(\"stopAtFrame\", RichTypeNumber, -1);\n    }\n    _preparePendingTasks(context) {\n        const animationToStopValue = this.animationGroup.getValue(context);\n        const stopAtFrame = this.stopAtFrame.getValue(context) ?? -1;\n        // get the context variable\n        const pendingStopAnimations = context._getGlobalContextVariable(\"pendingStopAnimations\", []);\n        // add the animation to the list\n        pendingStopAnimations.push({ uniqueId: animationToStopValue.uniqueId, stopAtFrame });\n        // set the global context variable\n        context._setGlobalContextVariable(\"pendingStopAnimations\", pendingStopAnimations);\n    }\n    _cancelPendingTasks(context) {\n        // remove the animation from the list\n        const animationToStopValue = this.animationGroup.getValue(context);\n        const pendingStopAnimations = context._getGlobalContextVariable(\"pendingStopAnimations\", []);\n        for (let i = 0; i < pendingStopAnimations.length; i++) {\n            if (pendingStopAnimations[i].uniqueId === animationToStopValue.uniqueId) {\n                pendingStopAnimations.splice(i, 1);\n                // set the global context variable\n                context._setGlobalContextVariable(\"pendingStopAnimations\", pendingStopAnimations);\n                break;\n            }\n        }\n    }\n    _execute(context) {\n        const animationToStopValue = this.animationGroup.getValue(context);\n        const stopTime = this.stopAtFrame.getValue(context) ?? -1;\n        // check the values\n        if (!animationToStopValue) {\n            Logger.Warn(\"No animation group provided to stop.\");\n            return this._reportError(context, \"No animation group provided to stop.\");\n        }\n        if (isNaN(stopTime)) {\n            return this._reportError(context, \"Invalid stop time.\");\n        }\n        if (stopTime > 0) {\n            this._startPendingTasks(context);\n        }\n        else {\n            this._stopAnimation(animationToStopValue, context);\n        }\n        // note that out will not be triggered in case of an error\n        this.out._activateSignal(context);\n    }\n    _executeOnTick(context) {\n        const animationToStopValue = this.animationGroup.getValue(context);\n        // check each frame if any animation should be stopped\n        const pendingStopAnimations = context._getGlobalContextVariable(\"pendingStopAnimations\", []);\n        for (let i = 0; i < pendingStopAnimations.length; i++) {\n            // compare the uniqueId to the animation to stop\n            if (pendingStopAnimations[i].uniqueId === animationToStopValue.uniqueId) {\n                // check if the current frame is AFTER the stopAtFrame\n                if (animationToStopValue.getCurrentFrame() >= pendingStopAnimations[i].stopAtFrame) {\n                    // stop the animation\n                    this._stopAnimation(animationToStopValue, context);\n                    // remove the animation from the list\n                    pendingStopAnimations.splice(i, 1);\n                    // set the global context variable\n                    context._setGlobalContextVariable(\"pendingStopAnimations\", pendingStopAnimations);\n                    this.done._activateSignal(context);\n                    context._removePendingBlock(this);\n                    break;\n                }\n            }\n        }\n    }\n    /**\n     * @returns class name of the block.\n     */\n    getClassName() {\n        return \"FlowGraphStopAnimationBlock\" /* FlowGraphBlockNames.StopAnimation */;\n    }\n    _stopAnimation(animationGroup, context) {\n        const currentlyRunning = context._getGlobalContextVariable(\"currentlyRunningAnimationGroups\", []);\n        const index = currentlyRunning.indexOf(animationGroup.uniqueId);\n        if (index !== -1) {\n            animationGroup.stop();\n            currentlyRunning.splice(index, 1);\n            // update the global context variable\n            context._setGlobalContextVariable(\"currentlyRunningAnimationGroups\", currentlyRunning);\n        }\n        else {\n            // Logger.Warn(\"Trying to stop an animation that is not running.\");\n            // no-op for now. Probably no need to log anything here.\n        }\n    }\n}\nRegisterClass(\"FlowGraphStopAnimationBlock\" /* FlowGraphBlockNames.StopAnimation */, FlowGraphStopAnimationBlock);\n//# sourceMappingURL=flowGraphStopAnimationBlock.js.map"],"names":[],"mappings":"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"}