{"version":3,"file":"flowGraphMeshPickEventBlock-ClzS9rIO.esm.js","sources":["../../../../../dev/core/dist/FlowGraph/Blocks/Event/flowGraphMeshPickEventBlock.js"],"sourcesContent":["import { FlowGraphEventBlock } from \"../../flowGraphEventBlock\";\nimport { PointerEventTypes } from \"../../../Events/pointerEvents\";\nimport { RegisterClass } from \"../../../Misc/typeStore\";\nimport { _IsDescendantOf } from \"../../utils\";\nimport { RichTypeAny, RichTypeNumber, RichTypeVector3 } from \"core/FlowGraph/flowGraphRichTypes\";\n/**\n * A block that activates when a mesh is picked.\n */\nexport class FlowGraphMeshPickEventBlock extends FlowGraphEventBlock {\n    constructor(\n    /**\n     * the configuration of the block\n     */\n    config) {\n        super(config);\n        this.config = config;\n        /**\n         * the type of the event this block reacts to\n         */\n        this.type = \"MeshPick\" /* FlowGraphEventType.MeshPick */;\n        this.asset = this.registerDataInput(\"asset\", RichTypeAny, config?.targetMesh);\n        this.pickedPoint = this.registerDataOutput(\"pickedPoint\", RichTypeVector3);\n        this.pickOrigin = this.registerDataOutput(\"pickOrigin\", RichTypeVector3);\n        this.pointerId = this.registerDataOutput(\"pointerId\", RichTypeNumber);\n        this.pickedMesh = this.registerDataOutput(\"pickedMesh\", RichTypeAny);\n        this.pointerType = this.registerDataInput(\"pointerType\", RichTypeAny, PointerEventTypes.POINTERPICK);\n    }\n    _getReferencedMesh(context) {\n        return this.asset.getValue(context);\n    }\n    _executeEvent(context, pickedInfo) {\n        // get the pointer type\n        const pointerType = this.pointerType.getValue(context);\n        if (pointerType !== pickedInfo.type) {\n            // returning true here to continue the propagation of the pointer event to the rest of the blocks\n            return true;\n        }\n        // check if the mesh is the picked mesh or a descendant\n        const mesh = this._getReferencedMesh(context);\n        if (mesh && pickedInfo.pickInfo?.pickedMesh && (pickedInfo.pickInfo?.pickedMesh === mesh || _IsDescendantOf(pickedInfo.pickInfo?.pickedMesh, mesh))) {\n            this.pointerId.setValue(pickedInfo.event.pointerId, context);\n            this.pickOrigin.setValue(pickedInfo.pickInfo.ray?.origin, context);\n            this.pickedPoint.setValue(pickedInfo.pickInfo.pickedPoint, context);\n            this.pickedMesh.setValue(pickedInfo.pickInfo.pickedMesh, context);\n            this._execute(context);\n            // stop the propagation if the configuration says so\n            return !this.config?.stopPropagation;\n        }\n        else {\n            // reset the outputs\n            this.pointerId.resetToDefaultValue(context);\n            this.pickOrigin.resetToDefaultValue(context);\n            this.pickedPoint.resetToDefaultValue(context);\n            this.pickedMesh.resetToDefaultValue(context);\n        }\n        return true;\n    }\n    /**\n     * @internal\n     */\n    _preparePendingTasks(_context) {\n        // no-op\n    }\n    /**\n     * @internal\n     */\n    _cancelPendingTasks(_context) {\n        // no-op\n    }\n    /**\n     * @returns class name of the block.\n     */\n    getClassName() {\n        return \"FlowGraphMeshPickEventBlock\" /* FlowGraphBlockNames.MeshPickEvent */;\n    }\n}\nRegisterClass(\"FlowGraphMeshPickEventBlock\" /* FlowGraphBlockNames.MeshPickEvent */, FlowGraphMeshPickEventBlock);\n//# sourceMappingURL=flowGraphMeshPickEventBlock.js.map"],"names":[],"mappings":"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"}