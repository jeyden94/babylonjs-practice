{"version":3,"file":"flowGraphSetPropertyBlock-nSp0Plad.esm.js","sources":["../../../../../dev/core/dist/FlowGraph/Blocks/Execution/flowGraphSetPropertyBlock.js"],"sourcesContent":["import { FlowGraphExecutionBlockWithOutSignal } from \"core/FlowGraph/flowGraphExecutionBlockWithOutSignal\";\nimport { RichTypeAny } from \"core/FlowGraph/flowGraphRichTypes\";\nimport { RegisterClass } from \"core/Misc/typeStore\";\n/**\n * This block will set a property on a given target asset.\n * The property name can include dots (\".\"), which will be interpreted as a path to the property.\n * The target asset is an input and can be changed at any time.\n * The value of the property is an input and can be changed at any time.\n *\n * For example, with an input of a mesh asset, the property name \"position.x\" will set the x component of the position of the mesh.\n *\n * Note that it is recommended to input the object on which you are working on (i.e. a material) than providing a mesh and then getting the material from it.\n */\nexport class FlowGraphSetPropertyBlock extends FlowGraphExecutionBlockWithOutSignal {\n    constructor(\n    /**\n     * the configuration of the block\n     */\n    config) {\n        super(config);\n        this.config = config;\n        this.object = this.registerDataInput(\"object\", RichTypeAny, config.target);\n        this.value = this.registerDataInput(\"value\", RichTypeAny);\n        this.propertyName = this.registerDataInput(\"propertyName\", RichTypeAny, config.propertyName);\n        this.customSetFunction = this.registerDataInput(\"customSetFunction\", RichTypeAny);\n    }\n    _execute(context, _callingSignal) {\n        try {\n            const target = this.object.getValue(context);\n            const value = this.value.getValue(context);\n            const propertyName = this.propertyName.getValue(context);\n            this._stopRunningAnimations(context, target, propertyName);\n            const setFunction = this.customSetFunction.getValue(context);\n            if (setFunction) {\n                setFunction(target, propertyName, value, context);\n            }\n            else {\n                this._setPropertyValue(target, propertyName, value);\n            }\n        }\n        catch (e) {\n            this._reportError(context, e);\n        }\n        this.out._activateSignal(context);\n    }\n    _stopRunningAnimations(context, target, propertyName) {\n        const currentlyRunningAnimationGroups = context._getGlobalContextVariable(\"currentlyRunningAnimationGroups\", []);\n        for (const uniqueId of currentlyRunningAnimationGroups) {\n            const animationGroup = context.assetsContext.animationGroups.find((animationGroup) => animationGroup.uniqueId === uniqueId);\n            if (animationGroup) {\n                for (const targetedAnimations of animationGroup.targetedAnimations) {\n                    if (targetedAnimations.target === target && targetedAnimations.animation.targetProperty === propertyName) {\n                        animationGroup.stop(true);\n                        animationGroup.dispose();\n                        const index = currentlyRunningAnimationGroups.indexOf(uniqueId);\n                        if (index !== -1) {\n                            currentlyRunningAnimationGroups.splice(index, 1);\n                            context._setGlobalContextVariable(\"currentlyRunningAnimationGroups\", currentlyRunningAnimationGroups);\n                        }\n                    }\n                }\n            }\n        }\n    }\n    _setPropertyValue(target, propertyName, value) {\n        const path = propertyName.split(\".\");\n        let obj = target;\n        for (let i = 0; i < path.length - 1; i++) {\n            const prop = path[i];\n            if (obj[prop] === undefined) {\n                obj[prop] = {};\n            }\n            obj = obj[prop];\n        }\n        obj[path[path.length - 1]] = value;\n    }\n    getClassName() {\n        return \"FlowGraphSetPropertyBlock\" /* FlowGraphBlockNames.SetProperty */;\n    }\n}\nRegisterClass(\"FlowGraphSetPropertyBlock\" /* FlowGraphBlockNames.SetProperty */, FlowGraphSetPropertyBlock);\n//# sourceMappingURL=flowGraphSetPropertyBlock.js.map"],"names":[],"mappings":";;;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAM,yBAAyB,SAAS,oCAAoC,CAAC;AACpF,IAAI,WAAW;AACf;AACA;AACA;AACA,IAAI,MAAM,EAAE;AACZ,QAAQ,KAAK,CAAC,MAAM,CAAC;AACrB,QAAQ,IAAI,CAAC,MAAM,GAAG,MAAM;AAC5B,QAAQ,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,iBAAiB,CAAC,QAAQ,EAAE,WAAW,EAAE,MAAM,CAAC,MAAM,CAAC;AAClF,QAAQ,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,iBAAiB,CAAC,OAAO,EAAE,WAAW,CAAC;AACjE,QAAQ,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,iBAAiB,CAAC,cAAc,EAAE,WAAW,EAAE,MAAM,CAAC,YAAY,CAAC;AACpG,QAAQ,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,iBAAiB,CAAC,mBAAmB,EAAE,WAAW,CAAC;AACzF;AACA,IAAI,QAAQ,CAAC,OAAO,EAAE,cAAc,EAAE;AACtC,QAAQ,IAAI;AACZ,YAAY,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,OAAO,CAAC;AACxD,YAAY,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC;AACtD,YAAY,MAAM,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,OAAO,CAAC;AACpE,YAAY,IAAI,CAAC,sBAAsB,CAAC,OAAO,EAAE,MAAM,EAAE,YAAY,CAAC;AACtE,YAAY,MAAM,WAAW,GAAG,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,OAAO,CAAC;AACxE,YAAY,IAAI,WAAW,EAAE;AAC7B,gBAAgB,WAAW,CAAC,MAAM,EAAE,YAAY,EAAE,KAAK,EAAE,OAAO,CAAC;AACjE;AACA,iBAAiB;AACjB,gBAAgB,IAAI,CAAC,iBAAiB,CAAC,MAAM,EAAE,YAAY,EAAE,KAAK,CAAC;AACnE;AACA;AACA,QAAQ,OAAO,CAAC,EAAE;AAClB,YAAY,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC,CAAC;AACzC;AACA,QAAQ,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,OAAO,CAAC;AACzC;AACA,IAAI,sBAAsB,CAAC,OAAO,EAAE,MAAM,EAAE,YAAY,EAAE;AAC1D,QAAQ,MAAM,+BAA+B,GAAG,OAAO,CAAC,yBAAyB,CAAC,iCAAiC,EAAE,EAAE,CAAC;AACxH,QAAQ,KAAK,MAAM,QAAQ,IAAI,+BAA+B,EAAE;AAChE,YAAY,MAAM,cAAc,GAAG,OAAO,CAAC,aAAa,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,cAAc,KAAK,cAAc,CAAC,QAAQ,KAAK,QAAQ,CAAC;AACvI,YAAY,IAAI,cAAc,EAAE;AAChC,gBAAgB,KAAK,MAAM,kBAAkB,IAAI,cAAc,CAAC,kBAAkB,EAAE;AACpF,oBAAoB,IAAI,kBAAkB,CAAC,MAAM,KAAK,MAAM,IAAI,kBAAkB,CAAC,SAAS,CAAC,cAAc,KAAK,YAAY,EAAE;AAC9H,wBAAwB,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC;AACjD,wBAAwB,cAAc,CAAC,OAAO,EAAE;AAChD,wBAAwB,MAAM,KAAK,GAAG,+BAA+B,CAAC,OAAO,CAAC,QAAQ,CAAC;AACvF,wBAAwB,IAAI,KAAK,KAAK,EAAE,EAAE;AAC1C,4BAA4B,+BAA+B,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC;AAC5E,4BAA4B,OAAO,CAAC,yBAAyB,CAAC,iCAAiC,EAAE,+BAA+B,CAAC;AACjI;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,iBAAiB,CAAC,MAAM,EAAE,YAAY,EAAE,KAAK,EAAE;AACnD,QAAQ,MAAM,IAAI,GAAG,YAAY,CAAC,KAAK,CAAC,GAAG,CAAC;AAC5C,QAAQ,IAAI,GAAG,GAAG,MAAM;AACxB,QAAQ,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;AAClD,YAAY,MAAM,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC;AAChC,YAAY,IAAI,GAAG,CAAC,IAAI,CAAC,KAAK,SAAS,EAAE;AACzC,gBAAgB,GAAG,CAAC,IAAI,CAAC,GAAG,EAAE;AAC9B;AACA,YAAY,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC;AAC3B;AACA,QAAQ,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,GAAG,KAAK;AAC1C;AACA,IAAI,YAAY,GAAG;AACnB,QAAQ,OAAO,2BAA2B;AAC1C;AACA;AACA,aAAa,CAAC,2BAA2B,wCAAwC,yBAAyB,CAAC;;;;"}