import{C as e,L as t,m as r}from"./index-1dDxZ_0d.esm.min.js";import{WebGPUEngine as s}from"./webgpuEngine-DsZGoNHf.esm.min.js";import"./bakedVertexAnimation-B8N_4gUX.esm.min.js";import"./instancesDeclaration-txBuJov6.esm.min.js";import"./helperFunctions-C7x1gbYM.esm.min.js";import"./fresnelFunction-HW_mgKpp.esm.min.js";import"./meshUboDeclaration-tfozhicW.esm.min.js";import"./sceneUboDeclaration-CT813MrN.esm.min.js";import"./decalFragment-CIx2XMRp.esm.min.js";import"./audioEngine-DJDvAuHS.esm.min.js";s.prototype.unBindMultiColorAttachmentFramebuffer=function(e,t=!1,r){r&&r(),this._endCurrentRenderPass(),e.disableAutomaticMSAAResolve||this.resolveMultiFramebuffer(e,!1),t||this.generateMipMapsMultiFramebuffer(e),this._currentRenderTarget=null,this._mrtAttachments=[],this._cacheRenderPipeline.setMRT([]),this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments)},s.prototype.createMultipleRenderTarget=function(s,n,a){let i=!1,p=!0,u=!1,o=!1,l=e.TEXTUREFORMAT_DEPTH16,T=1,c=1;const h=e.TEXTURETYPE_UNSIGNED_BYTE,m=e.TEXTURE_TRILINEAR_SAMPLINGMODE,E=e.TEXTUREFORMAT_RGBA,_=e.TEXTURE_2D;let R=[],f=[],d=[],M=[],A=[],g=[],x=[],S=[],D=[],F=[],b=!1;const U=this._createHardwareRenderTargetWrapper(!0,!1,s);void 0!==n&&(i=n.generateMipMaps??!1,p=n.generateDepthBuffer??!0,u=n.generateStencilBuffer??!1,o=n.generateDepthTexture??!1,T=n.textureCount??1,l=n.depthTextureFormat??e.TEXTUREFORMAT_DEPTH16,R=n.types||R,f=n.samplingModes||f,d=n.useSRGBBuffers||d,M=n.formats||M,A=n.targetTypes||A,g=n.faceIndex||g,x=n.layerIndex||x,S=n.layerCounts||S,D=n.labels||D,F=n.creationFlags||F,c=n.samples??c,b=n.dontCreateTextures??!1);const y=s.width??s,P=s.height??s,X=[],L=[],B=[];U.label=n?.label??"MultiRenderTargetWrapper",U._generateDepthBuffer=p,U._generateStencilBuffer=u,U._attachments=L,U._defaultAttachments=B;let C=null;(p||u||o)&&!b&&(o||(l=p&&u?e.TEXTUREFORMAT_DEPTH24_STENCIL8:p?e.TEXTUREFORMAT_DEPTH32_FLOAT:e.TEXTUREFORMAT_STENCIL8),C=U.createDepthStencilTexture(0,!1,u,1,l,U.label+"-DepthStencil"));const O=void 0!==n&&"object"==typeof n&&n.createMipMaps&&!i;for(let s=0;s<T;s++){let n=f[s]||m,p=R[s]||h;const u=M[s]||E,o=!!d[s]&&this._caps.supportSRGBBuffers,l=A[s]||_,T=S[s]??1,c=F[s];if((p!==e.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(p!==e.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(n=e.TEXTURE_NEAREST_SAMPLINGMODE),p!==e.TEXTURETYPE_FLOAT||this._caps.textureFloat||(p=e.TEXTURETYPE_UNSIGNED_BYTE,t.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),L.push(s+1),B.push(a?s+1:0===s?1:0),-1===l||b)continue;const g=new r(this,6);switch(X[s]=g,l){case e.TEXTURE_CUBE_MAP:g.isCube=!0;break;case e.TEXTURE_3D:g.is3D=!0,g.baseDepth=g.depth=T;break;case e.TEXTURE_2D_ARRAY:g.is2DArray=!0,g.baseDepth=g.depth=T}g.baseWidth=y,g.baseHeight=P,g.width=y,g.height=P,g.isReady=!0,g.samples=1,g.generateMipMaps=i,g.samplingMode=n,g.type=p,g._cachedWrapU=e.TEXTURE_CLAMP_ADDRESSMODE,g._cachedWrapV=e.TEXTURE_CLAMP_ADDRESSMODE,g._useSRGBBuffer=o,g.format=u,g.label=D[s]??U.label+"-Texture"+s,this._internalTexturesCache.push(g),O&&(g.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(g,void 0,void 0,void 0,c,!0),O&&(g.generateMipMaps=!1)}return C&&(C.incrementReferences(),X[T]=C,this._internalTexturesCache.push(C)),U.setTextures(X),U.setLayerAndFaceIndices(x,g),b?U._samples=c:this.updateMultipleRenderTargetTextureSampleCount(U,c),U},s.prototype.updateMultipleRenderTargetTextureSampleCount=function(e,t){if(!e||!e.textures||0===e.textures.length||e.textures[0].samples===t)return t;const r=e.textures.length;if(0===r)return 1;t=Math.min(t,this.getCaps().maxMSAASamples);for(let t=0;t<r;++t){const r=e.textures[t]._hardwareTexture;r?.releaseMSAATexture(e.getBaseArrayLayer(t))}const s=e._depthStencilTexture===e.textures[r-1];for(let s=0;s<r;++s){const r=e.textures[s];this._textureHelper.createMSAATexture(r,t,!1,e.getBaseArrayLayer(s)),r.samples=t}return e._depthStencilTexture&&!s&&(this._textureHelper.createMSAATexture(e._depthStencilTexture,t),e._depthStencilTexture.samples=t),e._samples=t,t},s.prototype.generateMipMapsMultiFramebuffer=function(e){const t=e;if(!t.isMulti)return;const r=t._attachments.length;for(let e=0;e<r;e++){const r=t.textures[e];!r.generateMipMaps||r.isCube||r.is3D||this._generateMipmaps(r)}},s.prototype.resolveMultiFramebuffer=function(e,t=!0){this.resolveFramebuffer(e,t)},s.prototype.bindAttachments=function(e){0!==e.length&&this._currentRenderTarget&&(this._mrtAttachments=e,this._currentRenderPass&&this._cacheRenderPipeline.setMRTAttachments(e))},s.prototype.buildTextureLayout=function(e,t=!1){const r=[];if(t)r.push(1);else for(let t=0;t<e.length;t++)e[t]?r.push(t+1):r.push(0);return r},s.prototype.restoreSingleAttachment=function(){},s.prototype.restoreSingleAttachmentForRenderTarget=function(){};
//# sourceMappingURL=engine.multiRender-BtxbTQZL.esm.min.js.map
